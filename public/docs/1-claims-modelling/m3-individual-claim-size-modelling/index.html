<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Introduction #   How to fit loss models to insurance data? Peculiar characteristics of insurance data:  complete vs incomplete set of observations left-truncated observations right-censored observations heavy tailed risks   Parametric distribution models  model parameter estimation judging quality of fit model selection criteria
(graphical, score-based approaches, information criteria)   Concepts and R functions are demonstrated with the help of some data sets  Steps in fitting loss models to data #   explore and summarise data  graphical explorations empirical moments and quantiles   select a set of candidate distributions  Pareto, Log-Normal, Inverse Gaussian, Gamma, etc.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="M3 Individual Claim Size Modelling" />
<meta property="og:description" content="Introduction #   How to fit loss models to insurance data? Peculiar characteristics of insurance data:  complete vs incomplete set of observations left-truncated observations right-censored observations heavy tailed risks   Parametric distribution models  model parameter estimation judging quality of fit model selection criteria
(graphical, score-based approaches, information criteria)   Concepts and R functions are demonstrated with the help of some data sets  Steps in fitting loss models to data #   explore and summarise data  graphical explorations empirical moments and quantiles   select a set of candidate distributions  Pareto, Log-Normal, Inverse Gaussian, Gamma, etc." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2022-02-22T07:50:15+11:00" />

<title>M3 Individual Claim Size Modelling | General Insurance Modelling - AM3</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.a08e958a0c32c71fa52257f56602fc9e6f4a8586733f7d90b6b544b160364dce.css" integrity="sha256-oI6Vigwyxx&#43;lIlf1ZgL8nm9KhYZzP32QtrVEsWA2Tc4=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.878ab88e3d4527cf91ebf122d3c2168ec5f07897eee262b8596684862c6a9b5e.js" integrity="sha256-h4q4jj1FJ8&#43;R6/Ei08IWjsXweJfu4mK4WWaEhixqm14=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  <script>
MathJax = {
  tex: {
      macros: { 
          angl: ["\\enclose{actuarial}{#1}", 1],
          alert:["\\textcolor{red}{#1}", 1],
          termins: ["A^{1}_{#1 : \\enclose{actuarial}{#2}}", 2],
          insend: ["\\bar{A}_{#1 : \\enclose{actuarial}{#2}}", 2],
          pureend: ["A^{\\,\\,\\,\\, 1}_{#1 : \\enclose{actuarial}{#2}}", 2],
          adv: ["\\maltese"]
      }
  }
};
</script>
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/img/PRIMARY_A_Vertical_Housed_RGB.png" alt="Logo" /><span style="color: black;">General Insurance Modelling - AM3</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0c375332c765cd598c6ce4ee8867890f" class="toggle"  />
    <label for="section-0c375332c765cd598c6ce4ee8867890f" class="flex justify-between">
      <a href="https://gim-am3.netlify.app/docs/0-subject-guide/" class="">Subject Guide</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://gim-am3.netlify.app/docs/0-subject-guide/Eligibility/" class="">Eligibility and Requirements</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://gim-am3.netlify.app/docs/0-subject-guide/SILO/" class="">Learning Outcomes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://gim-am3.netlify.app/docs/0-subject-guide/Activities/" class="">Activities</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://gim-am3.netlify.app/docs/0-subject-guide/Resources/" class="">Resources</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://gim-am3.netlify.app/docs/0-subject-guide/Assessment/" class="">Assessment</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-5b29660809eb857420b6473840d34e82" class="toggle"  />
    <label for="section-5b29660809eb857420b6473840d34e82" class="flex justify-between">
      <a href="https://gim-am3.netlify.app/docs/0-study-plan/" class="">Weekly Study Plan</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://gim-am3.netlify.app/docs/0-study-plan/week-1/" class="">Week 1 Study Plan</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://gim-am3.netlify.app/docs/0-prerequisite-knowledge/" class="">Prerequisite Knowledge</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://gim-am3.netlify.app/docs/m1-introduction/" class="">M1 Introduction</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://gim-am3.netlify.app/docs/1-claims-modelling/" class="">Claims Modelling (CS2 Section 1)</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://gim-am3.netlify.app/docs/1-claims-modelling/m2-collective-risk-modelling/" class="">M2 Collective Risk Modelling</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/" class=" active">M3 Individual Claim Size Modelling</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://gim-am3.netlify.app/docs/1-claims-modelling/m4-compound-approx/" class="">M4 Approximations for Compound Distributions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://gim-am3.netlify.app/docs/1-claims-modelling/m5-copulas/" class="">M5 Copulas</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://gim-am3.netlify.app/docs/1-claims-modelling/m6-extreme-value-theory/" class="">M6 Extreme Value Theory</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="https://canvas.lms.unimelb.edu.au/courses/145406/external_tools/4436?display=borderless" target="_blank" rel="noopener">
        Ed discussion forum
      </a>
  </li>
  
  <li>
    <a href="https://canvas.lms.unimelb.edu.au/courses/123529" target="_blank" rel="noopener">
        ACTL30007 Canvas
      </a>
  </li>
  
  <li>
    <a href="https://canvas.lms.unimelb.edu.au/courses/123552" target="_blank" rel="noopener">
        ACTL90020 Canvas
      </a>
  </li>
  
  <li>
    <a href="https://canvas.lms.unimelb.edu.au/courses/145406" target="_blank" rel="noopener">
        Community Canvas
      </a>
  </li>
  
  <li>
    <a href="https://canvas.lms.unimelb.edu.au/courses/145406/modules/items/3630303" target="_blank" rel="noopener">
        Pre-tutorial exercises
      </a>
  </li>
  
  <li>
    <a href="https://canvas.lms.unimelb.edu.au/courses/145406/modules/items/3630304" target="_blank" rel="noopener">
        Tutorial exercises
      </a>
  </li>
  
  <li>
    <a href="https://canvas.lms.unimelb.edu.au/courses/145406/modules/items/3630305" target="_blank" rel="noopener">
        Additional and Out-of-Scope exercises
      </a>
  </li>
  
  <li>
    <a href="" target="_blank" rel="noopener">
        __________________________
      </a>
  </li>
  
  <li>
    <a href="https://bavanzicv.netlify.app/" target="_blank" rel="noopener">
        Benjamin Avanzi
      </a>
  </li>
  
  <li>
    <a href="https://actl10001.netlify.app/" target="_blank" rel="noopener">
        Introduction to Actuarial Studies
      </a>
  </li>
  
  <li>
    <a href="https://communicate-data-with-r.netlify.app/" target="_blank" rel="noopener">
        Communicate Data with R
      </a>
  </li>
  
  <li>
    <a href="https://actuaries.asn.au/becoming-an-actuary/becoming-a-university-subscriber" target="_blank" rel="noopener">
        Actuaries Institute info
      </a>
  </li>
  
</ul>





<script src="//yihui.org/js/math-code.js"></script>
<script async
src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
</nav>




  <script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>M3 Individual Claim Size Modelling</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a>
      <ul>
        <li><a href="#steps-in-fitting-loss-models-to-data">Steps in fitting loss models to data</a></li>
        <li><a href="#insurance-data">Insurance data</a>
          <ul>
            <li><a href="#complete-vs-incomplete-data">Complete vs incomplete data</a></li>
            <li><a href="#left-truncation-and-right-censoring">Left-truncation and right-censoring</a></li>
            <li><a href="#zero-claims">Zero claims</a></li>
            <li><a href="#heavy-tailed-risks">Heavy tailed risks</a></li>
          </ul>
        </li>
        <li><a href="#data-set-used-for-illustrations">Data set used for illustrations</a></li>
      </ul>
    </li>
    <li><a href="#data-analysis-and-descriptive-statistics-mw-31">Data analysis and descriptive statistics (MW 3.1)</a>
      <ul>
        <li><a href="#raw-data">Raw data</a>
          <ul>
            <li><a href="#visualise-the-suva-raw-data">Visualise the SUVA raw data</a></li>
            <li><a href="#log-of-raw-suva-data">log of raw SUVA data</a></li>
          </ul>
        </li>
        <li><a href="#moments">Moments</a>
          <ul>
            <li><a href="#suva-moments">SUVA moments</a></li>
            <li><a href="#suva-medical-costs-skewness-and-kurtosis">SUVA Medical Costs skewness and kurtosis</a></li>
            <li><a href="#suva-daily-allowance-skewness-and-kurtosis">SUVA Daily Allowance skewness and kurtosis</a></li>
            <li><a href="#loss-index-function">Loss index function</a></li>
            <li><a href="#mean-excess-function">Mean excess function</a></li>
          </ul>
        </li>
        <li><a href="#quantiles">Quantiles</a></li>
        <li><a href="#boxplots">Boxplots</a></li>
        <li><a href="#log-log-plots">Log-log plots</a>
          <ul>
            <li><a href="#suva-log-log-plots">SUVA log-log plots</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#selected-parametric-claims-size-distributions-mw-32">Selected parametric claims size distributions (MW 3.2)</a>
      <ul>
        <li><a href="#parametric-models-for-severity-y">Parametric models for severity <code>\(Y\)</code></a>
          <ul>
            <li><a href="#gamma">Gamma</a></li>
            <li><a href="#inverse-gaussian">Inverse Gaussian</a></li>
            <li><a href="#weibull">Weibull</a></li>
            <li><a href="#lognormal">Lognormal</a></li>
            <li><a href="#log-gamma">Log-gamma</a></li>
            <li><a href="#pareto-distribution">Pareto Distribution</a></li>
          </ul>
        </li>
        <li><a href="#extreme-value-theory">Extreme Value Theory</a></li>
      </ul>
    </li>
    <li><a href="#fitting-of-distributions-mw32">Fitting of distributions (MW3.2)</a>
      <ul>
        <li><a href="#introduction-1">Introduction</a>
          <ul>
            <li><a href="#r-and-technical-notes">R and technical notes</a></li>
          </ul>
        </li>
        <li><a href="#moment-matching-estimation-mme">Moment matching estimation (MME)</a>
          <ul>
            <li><a href="#mme-for-suva">MME for SUVA</a></li>
          </ul>
        </li>
        <li><a href="#maximum-likelihood-estimation-mle">Maximum likelihood estimation (MLE)</a>
          <ul>
            <li><a href="#mle-for-suva">MLE for SUVA</a></li>
          </ul>
        </li>
        <li><a href="#parameter-uncertainty">Parameter uncertainty</a>
          <ul>
            <li><a href="#hessian-matrix">Hessian matrix</a></li>
            <li><a href="#the-wald-approximation">The Wald approximation</a></li>
            <li><a href="#standard-errors-for-suva-data">Standard errors for SUVA data</a></li>
          </ul>
        </li>
        <li><a href="#adv-bootstrap"><code>\(\adv\)</code> Bootstrap</a>
          <ul>
            <li><a href="#adv-suva-contours-and-bootstrap-results"><code>\(\adv\)</code> SUVA contours and bootstrap results</a></li>
            <li><a href="#adv-confidence-intervals-on-other-quantities"><code>\(\adv\)</code> Confidence intervals on other quantities</a></li>
          </ul>
        </li>
        <li><a href="#dealing-with-left-truncation-and-right-censoring">Dealing with left-truncation and right-censoring</a>
          <ul>
            <li><a href="#coding-of-censored-data-in-r">Coding of censored data in R</a></li>
            <li><a href="#fitting-censored-data">Fitting censored data</a></li>
            <li><a href="#left-truncation-and-r">Left-truncation and R</a></li>
            <li><a href="#fitting-a-single-level-of-left-trancated-and-right-censored-data">Fitting a single level of left-trancated and right-censored data</a></li>
            <li><a href="#fitting-multiple-levels-of-left-trancated-and-right-censored-data">Fitting multiple levels of left-trancated and right-censored data</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#model-selection-mw-33">Model selection (MW 3.3)</a>
      <ul>
        <li><a href="#graphical-approaches">Graphical approaches</a>
          <ul>
            <li><a href="#p-p-plot">P-P plot</a></li>
            <li><a href="#q-q-plot">Q-Q plot</a></li>
            <li><a href="#suva-gof-graphs">SUVA GOF graphs</a></li>
          </ul>
        </li>
        <li><a href="#hypothesis-tests">Hypothesis tests</a>
          <ul>
            <li><a href="#kolmogorov-smirnoff-test">Kolmogorov-Smirnoff test</a></li>
            <li><a href="#anderson-darling-test">Anderson-Darling test</a></li>
            <li><a href="#chi-2-goodness-of-fit-test"><code>\(\chi ^{2}\)</code> goodness-of-fit test</a></li>
            <li><a href="#how-these-tests-are-used">How these tests are used</a></li>
            <li><a href="#comparison">Comparison</a></li>
          </ul>
        </li>
        <li><a href="#information-criteria">Information criteria</a>
          <ul>
            <li><a href="#suva-gof-stats">SUVA GOF stats</a></li>
            <li><a href="#gof-actual-hypothesis-test-results">GOF Actual hypothesis test results</a></li>
            <li><a href="#gof-graphical-comparisons">GOF graphical comparisons</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#adv-other-advanced-topics"><code>\(\adv\)</code> Other advanced topics</a>
      <ul>
        <li><a href="#adv-alternative-methods-for-estimation"><code>\(\adv\)</code> Alternative methods for estimation</a>
          <ul>
            <li><a href="#adv-maximum-goodness-estimation-mge"><code>\(\adv\)</code> Maximum Goodness Estimation (MGE)</a></li>
            <li><a href="#adv-ad-based-parameter-estimation"><code>\(\adv\)</code> AD based parameter estimation</a></li>
            <li><a href="#adv-quantile-matching"><code>\(\adv\)</code> Quantile matching</a></li>
          </ul>
        </li>
        <li><a href="#adv-zero-inflated-severity-model-xib"><code>\(\adv\)</code> Zero-inflated severity model <code>\(X=IB\)</code></a>
          <ul>
            <li><a href="#adv-resulting-distribution"><code>\(\adv\)</code> Resulting distribution</a></li>
            <li><a href="#adv-mean-and-variance"><code>\(\adv\)</code> Mean and Variance</a></li>
            <li><a href="#adv-special-case-xib"><code>\(\adv\)</code> Special case: <code>\(X=Ib\)</code></a></li>
            <li><a href="#adv-example-bicycle-theft-get-b-out-of-x"><code>\(\adv\)</code> Example: Bicycle Theft (get <code>\(B\)</code> out of <code>\(X\)</code>)</a></li>
            <li><a href="#adv-example"><code>\(\adv\)</code> Example</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#calculating-within-layers-for-claim-sizes-mw-34">Calculating within layers for claim sizes (MW 3.4)</a>
      <ul>
        <li><a href="#usual-policy-transformations">Usual policy transformations</a>
          <ul>
            <li><a href="#deductible-and-policy-limit">Deductible and Policy Limit</a></li>
          </ul>
        </li>
        <li><a href="#reinsurance">Reinsurance</a></li>
        <li><a href="#proportional-reinsurance">Proportional reinsurance</a></li>
        <li><a href="#nonproportional-reinsurance">Nonproportional reinsurance</a>
          <ul>
            <li><a href="#example">Example</a></li>
            <li><a href="#adv-the-actuar-coverage-function"><code>\(\adv\)</code> The <code>actuar</code> <code>coverage</code> function</a></li>
            <li><a href="#a-useful-identity">A useful identity</a></li>
          </ul>
        </li>
        <li><a href="#stop-loss-premiums">Stop loss premiums</a>
          <ul>
            <li><a href="#example-1">Example</a></li>
            <li><a href="#adv-recursive-formulas-in-the-discrete-case"><code>\(\adv\)</code> Recursive formulas in the discrete case</a></li>
            <li><a href="#adv-numerical-example"><code>\(\adv\)</code> Numerical example</a></li>
          </ul>
        </li>
        <li><a href="#leverage-effect-of-claims-inflation">Leverage effect of claims inflation</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
<script src="//yihui.org/js/math-code.js"></script>
<script async
src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>


  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="introduction">
  Introduction
  <a class="anchor" href="#introduction">#</a>
</h1>
<ul>
<li>How to fit loss models to insurance data?</li>
<li>Peculiar characteristics of insurance data:
<ul>
<li>complete vs incomplete set of observations</li>
<li>left-truncated observations</li>
<li>right-censored observations</li>
<li>heavy tailed risks</li>
</ul>
</li>
<li>Parametric distribution models
<ul>
<li>model parameter estimation</li>
<li>judging quality of fit</li>
<li>model selection criteria<br>
(graphical, score-based approaches, information criteria)</li>
</ul>
</li>
<li>Concepts and R functions are demonstrated with the help of some data sets</li>
</ul>
<h2 id="steps-in-fitting-loss-models-to-data">
  Steps in fitting loss models to data
  <a class="anchor" href="#steps-in-fitting-loss-models-to-data">#</a>
</h2>
<ol>
<li>explore and summarise data
<ul>
<li>graphical explorations</li>
<li>empirical moments and quantiles</li>
</ul>
</li>
<li>select a set of candidate distributions
<ul>
<li>Pareto, Log-Normal, Inverse Gaussian, Gamma, etc.</li>
</ul>
</li>
<li>estimate the model parameters
<ul>
<li>method of moments</li>
<li>maximum likelihood (MLE)</li>
<li>maximum goodness (MGE)</li>
</ul>
</li>
<li>evaluate the quality of a given model
<ul>
<li>graphical procedures (qq, pp plots, empirical cdf’s)</li>
<li>score-based approaches (Kolmogorov-Smirnoff tests, AD tests, chi-square goodness-of-fit tests)</li>
<li>likelihood based information criteria (AIC, BIC)</li>
</ul>
</li>
<li>determine which model to choose based on needs</li>
</ol>
<h2 id="insurance-data">
  Insurance data
  <a class="anchor" href="#insurance-data">#</a>
</h2>
<h3 id="complete-vs-incomplete-data">
  Complete vs incomplete data
  <a class="anchor" href="#complete-vs-incomplete-data">#</a>
</h3>
<ul>
<li>complete, individual data
<ul>
<li>you observe the exact value of the loss</li>
</ul>
</li>
<li>incomplete data
<ul>
<li>exact data may not be available</li>
<li>in loss/claims data, these arise in the following situations:
<ol>
<li>observations may be grouped - observe only the range of values in which the data belongs</li>
<li>presence of censoring and/or truncation</li>
<li>due to typical insurance and reinsurance arrangements such as deductibles and limits</li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="left-truncation-and-right-censoring">
  Left-truncation and right-censoring
  <a class="anchor" href="#left-truncation-and-right-censoring">#</a>
</h3>
<ul>
<li>left-truncated observation (e.g. excess / deductible)
<ul>
<li>observation is left-truncated at <code>\(c\)</code> if it is NOT recorded when it is below <code>\(c\)</code> and when it is above <code>\(c\)</code>, it is recorded at its exact value.</li>
</ul>
</li>
<li>right-censored observation (e.g. policy limit)
<ul>
<li>observation is right-censored at <code>\(d\)</code> if when it is above <code>\(d\)</code> it is recorded as being equal to <code>\(d\)</code> but when it is below <code>\(d\)</code> it is recorded at its observed value.</li>
</ul>
</li>
<li>similarly, we can define right-truncated, left-censored, <code>\(\ldots\)</code></li>
<li>of course, observations can be both left-truncated and right-censored; this is often the case in actuarial data</li>
</ul>
<h3 id="zero-claims">
  Zero claims
  <a class="anchor" href="#zero-claims">#</a>
</h3>
<ul>
<li>Significant proportions of zero claims are frequent, for a number of reasons:
<ul>
<li>Data is policy-based, not claims-based;</li>
<li>Claim not exceeding deductible;</li>
<li>Mandatory reporting of accidents;</li>
<li>etc…</li>
</ul>
</li>
<li>This complicates the fitting (parametric distributions often don’t have a flexible mass at 0, if at all)</li>
<li>Several possible solutions
<ul>
<li>Adjust <code>\(X\)</code> by mixing 0 with a parametric distribution</li>
<li>Adjust the frequency of claims accordingly (hence ignoring 0 claims), but this
<ul>
<li>may understate the volatility of claims (the proportion of 0’s may also be random)</li>
<li>should be avoided if 0’s are claims of no cost (rather than absence of claim)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="heavy-tailed-risks">
  Heavy tailed risks
  <a class="anchor" href="#heavy-tailed-risks">#</a>
</h3>
<ul>
<li>Essentially, these are risks that can be very large.</li>
<li>This is translated by thick tails, that is, a density that goes to zero slowly in the tails.</li>
<li>Typically, this means that the expectation of the excess over a threshold increases with that threshold.</li>
<li>We will encounter such losses here, but a full treatment is deferred to Module 6 (Extreme Value Theory).</li>
</ul>
<h2 id="data-set-used-for-illustrations">
  Data set used for illustrations
  <a class="anchor" href="#data-set-used-for-illustrations">#</a>
</h2>
<p>SUVA: bivariate data set of Swiss workers compensation medical and daily allowance costs:</p>
<ul>
<li>Example of real actuarial data; see Avanzi, Cassar, and Wong (2011)</li>
<li>Data were provided by the SUVA (Swiss workers compensation insurer)</li>
<li>Random sample of 5% of accident claims in construction sector with accident year 1999 (developped as of 2003)</li>
<li>Claims are (joint) medical costs and daily allowance costs</li>
</ul>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">SUVA <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">read_excel</span>(<span style="color:#e6db74">&#34;SUVA.xls&#34;</span>)
<span style="color:#a6e22e">as_tibble</span>(SUVA)
<span style="color:#66d9ef">...</span>
<span style="color:#75715e">## # A tibble: 2,326 x 2</span>
<span style="color:#75715e">##    medcosts dailyallow</span>
<span style="color:#75715e">##       &lt;dbl&gt;      &lt;dbl&gt;</span>
<span style="color:#75715e">##  1      407          0</span>
<span style="color:#75715e">##  2    12591      13742</span>
<span style="color:#75715e">##  3      269          0</span>
<span style="color:#75715e">##  4      142          0</span>
<span style="color:#75715e">##  5      175          0</span>
<span style="color:#75715e">##  6      298        839</span>
<span style="color:#75715e">##  7       47          0</span>
<span style="color:#66d9ef">...</span>
</code></pre></div><h1 id="data-analysis-and-descriptive-statistics-mw-31">
  Data analysis and descriptive statistics (MW 3.1)
  <a class="anchor" href="#data-analysis-and-descriptive-statistics-mw-31">#</a>
</h1>
<p>It is essential, before any modelling is done, to make sure that one gets a good sense of what the data look like.</p>
<ul>
<li>For any type of data analysis, first thing to do is to summarise the data.
<ul>
<li>summary statistics: mean, median, standard deviation, coefficient of variation, skewness, quantiles, min, max, etc <code>\(\ldots\)</code></li>
<li>gives a preliminary understanding of the data</li>
</ul>
</li>
<li>Visualisating the data is often even more informative:
<ul>
<li>histogram, with associated kernel density</li>
<li>empirical cdf, which can be compared to that of a normal cdf via Q-Q or P-P plot</li>
</ul>
</li>
<li>When data are heavy tailed it often helps to perform the above on the log of the data (we can then compare the data to a lognormal)</li>
<li>Data collection procedures and standards should be understood</li>
<li>Any unusual feature (outliers, breaks, …) should be investigated. If possible, ask the claims adjusters or data owners about them.</li>
</ul>
<h2 id="raw-data">
  Raw data
  <a class="anchor" href="#raw-data">#</a>
</h2>
<h3 id="visualise-the-suva-raw-data">
  Visualise the SUVA raw data
  <a class="anchor" href="#visualise-the-suva-raw-data">#</a>
</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">plotdist</span>(SUVA<span style="color:#f92672">$</span>medcosts, histo <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, demp <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVAraw1-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">plotdist</span>(SUVA<span style="color:#f92672">$</span>dailyallow, histo <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, demp <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVAraw2-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">plotdist</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>], histo <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,
  demp <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVAraw3-1.png" width="672" /></p>
<p>A log transformation may help us see better what is happening.</p>
<h3 id="log-of-raw-suva-data">
  log of raw SUVA data
  <a class="anchor" href="#log-of-raw-suva-data">#</a>
</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">plotdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>medcosts[SUVA<span style="color:#f92672">$</span>medcosts <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>]), histo <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,
  demp <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVArawlog2-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">plotdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>]), histo <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,
  demp <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVArawlog4-1.png" width="672" /></p>
<hr>
<ul>
<li>Medical costs are still skewed even after a log transformation, which suggests that a very heavy tailed distribution might be necessary.</li>
<li>Daily allowance costs look symmetrical after the log transformation, which suggests a lognormal (or similar) distribution might be appropriate.</li>
<li>Removing 0’s is especially important for the daily allowance claims (and is necessary for taking the log anyway), as more than half of the claims are 0.</li>
</ul>
<h2 id="moments">
  Moments
  <a class="anchor" href="#moments">#</a>
</h2>
<p>Moments of a distribution provide information:</p>
<ul>
<li>The mean provides its location.</li>
<li>The second moment leads to the variance, and the coefficient of variation, which give an idea of the dispersion around the mean.</li>
<li>Skewness is self-explanatory.</li>
<li>Kurtosis provides an idea of how fat the tails are.</li>
</ul>
<hr>
<p>The following are also helpful:</p>
<ul>
<li>Loss size index function
<code>$$\mathcal{I}(G(y)) = \frac{\int_0^y z dG(z)}{\int_0^\infty z dG(z)} \quad \text{and} \quad \widehat{\mathcal{I}}_n(\alpha)=\frac{\sum_{i=1}^{\lfloor n \alpha \rfloor} Y_{(i)}}{\sum_{i=1}^n Y_i}$$</code>
for <code>\(\alpha \in [0,1]\)</code>. Corresponds of the contribution of <code>\([0,y]\)</code> to the overall mean. (see also , even though MW quotes 75% for GI claims)</li>
<li>Mean excess function
<code>$$e(u)=E[Y_i-u|Y_i&gt;u]  \quad \text{and} \quad \widehat{e}_n(u) = \frac{\sum_{i=1}^n (Y_i-u) 1_{\{Y_i&gt;u\}}}{\sum_{i=1}^n 1_{\{Y_i&gt;u\}}}$$</code>
This is useful for the analysis of large claims, and for the analysis of reinsurance. Increasing values of the mean excess function indicate a heavy tailed distribution (see also Module 6)
[Note <code>\(u=0\)</code> leads to the mean only when all claims are strictly positive.]</li>
</ul>
<hr>
<p>In R:</p>
<ul>
<li>To get numbers:
<ul>
<li>the function <code>actuar::emm</code> provides empirical moments up to any order</li>
<li><code>mean</code>, <code>stats:var</code> and <code>stats::sd</code> provide mean, variance, and standard deviation (unbiased versions)</li>
<li>codes for the Loss size index function are provided in the illustration</li>
<li>codes for the Mean excess function are also provided, but the graph is most easily plotted with <code>extRemes::mrlplot</code> as will be demonstrated</li>
</ul>
</li>
<li>The function <code>fistdistrplus:descdist</code> provides a graph that shows where the couple “skewness/kurtosis” lies, in comparison with its theoretically possible locations for a certain number of distributions.
<ul>
<li>the parameter <code>boot</code> allows for nonparametric bootstrapping of that coordinate, which helps with the assessment of its potential variability (it is sensitive to outliers, that is, not “robust”)</li>
<li><code>method</code> can be <code>&quot;unbiased&quot;</code> or <code>&quot;sample&quot;</code> for the unbiased or sample versions of the moments</li>
</ul>
</li>
</ul>
<h3 id="suva-moments">
  SUVA moments
  <a class="anchor" href="#suva-moments">#</a>
</h3>
<p>Medical costs:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">format</span>(actuar<span style="color:#f92672">::</span><span style="color:#a6e22e">emm</span>(SUVA<span style="color:#f92672">$</span>medcosts, order <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>), scientific <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</code></pre></div><pre><code>## [1] &quot;         1443.349&quot; &quot;     34268506.007&quot; &quot;1791560934502.502&quot;
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">sd</span>(SUVA<span style="color:#f92672">$</span>medcosts)<span style="color:#f92672">/</span><span style="color:#a6e22e">mean</span>(SUVA<span style="color:#f92672">$</span>medcosts)
</code></pre></div><pre><code>## [1] 3.93143
</code></pre>
<p>Daily allowance:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">format</span>(actuar<span style="color:#f92672">::</span><span style="color:#a6e22e">emm</span>(SUVA<span style="color:#f92672">$</span>dailyallow, order <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>), scientific <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</code></pre></div><pre><code>## [1] &quot;          3194.15&quot; &quot;     172677852.63&quot; &quot;20364647975482.07&quot;
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">sd</span>(SUVA<span style="color:#f92672">$</span>dailyallow)<span style="color:#f92672">/</span><span style="color:#a6e22e">mean</span>(SUVA<span style="color:#f92672">$</span>dailyallow)
</code></pre></div><pre><code>## [1] 3.991459
</code></pre>
<hr>
<p>Medical costs:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">format</span>(actuar<span style="color:#f92672">::</span><span style="color:#a6e22e">emm</span>(SUVA<span style="color:#f92672">$</span>medcosts[SUVA<span style="color:#f92672">$</span>medcosts <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>], order <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>),
  scientific <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</code></pre></div><pre><code>## [1] &quot;         1492.765&quot; &quot;     35441771.887&quot; &quot;1852899392464.571&quot;
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">sd</span>(SUVA<span style="color:#f92672">$</span>medcosts[SUVA<span style="color:#f92672">$</span>medcosts <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>])<span style="color:#f92672">/</span><span style="color:#a6e22e">mean</span>(SUVA<span style="color:#f92672">$</span>medcosts[SUVA<span style="color:#f92672">$</span>medcosts <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>])
</code></pre></div><pre><code>## [1] 3.861552
</code></pre>
<p>Daily allowance:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">format</span>(actuar<span style="color:#f92672">::</span><span style="color:#a6e22e">emm</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>], order <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>),
  scientific <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</code></pre></div><pre><code>## [1] &quot;          6760.322&quot; &quot;     365467411.472&quot; &quot;43101156679682.695&quot;
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">sd</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>])<span style="color:#f92672">/</span><span style="color:#a6e22e">mean</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>])
</code></pre></div><pre><code>## [1] 2.646343
</code></pre>
<h3 id="suva-medical-costs-skewness-and-kurtosis">
  SUVA Medical Costs skewness and kurtosis
  <a class="anchor" href="#suva-medical-costs-skewness-and-kurtosis">#</a>
</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">descdist</span>(SUVA<span style="color:#f92672">$</span>medcosts, boot <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-MC-desdist-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">descdist</span>(SUVA<span style="color:#f92672">$</span>medcosts[SUVA<span style="color:#f92672">$</span>medcosts <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>], boot <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-MC-desdist0-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">descdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>medcosts[SUVA<span style="color:#f92672">$</span>medcosts <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>]), boot <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-MC-desdist0log-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">descdist</span>(<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>medcosts[SUVA<span style="color:#f92672">$</span>medcosts <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>])), boot <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-MC-desdist0loglog-1.png" width="672" /></p>
<h3 id="suva-daily-allowance-skewness-and-kurtosis">
  SUVA Daily Allowance skewness and kurtosis
  <a class="anchor" href="#suva-daily-allowance-skewness-and-kurtosis">#</a>
</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">descdist</span>(SUVA<span style="color:#f92672">$</span>dailyallow, boot <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-DA-desdist-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">descdist</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>], boot <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-DA-desdist0-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">descdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>]), boot <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>)
</code></pre></div><pre><code>## summary statistics
## ------
## min:  3.258097   max:  12.13806 
## median:  7.474772 
## mean:  7.63051 
## estimated sd:  1.441014 
## estimated skewness:  0.3378648 
## estimated kurtosis:  3.259708
</code></pre>
<p>Note <code>descdist</code> also gives stats as above!
(not shown on the previous slides)</p>
<hr>
<p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-DA-desdist0log-1.png" width="672" /></p>
<p>Good candidates seem to be lognormal, gamma, and potentially Weibull.</p>
<h3 id="loss-index-function">
  Loss index function
  <a class="anchor" href="#loss-index-function">#</a>
</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">SUVA.MC.lif <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cumsum</span>(<span style="color:#a6e22e">sort</span>(SUVA<span style="color:#f92672">$</span>medcosts))<span style="color:#f92672">/</span><span style="color:#a6e22e">sum</span>(SUVA<span style="color:#f92672">$</span>medcosts)
<span style="color:#a6e22e">plot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">length</span>(SUVA<span style="color:#f92672">$</span>medcosts)<span style="color:#f92672">/</span><span style="color:#a6e22e">length</span>(SUVA<span style="color:#f92672">$</span>medcosts), SUVA.MC.lif,
  xlab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;number of claims (in 100%)&#34;</span>, ylab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;empirical loss size index function&#34;</span>)
<span style="color:#a6e22e">abline</span>(h <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25</span>, v <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.8</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-MC-LIF-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">SUVA.DA.lif <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cumsum</span>(<span style="color:#a6e22e">sort</span>(SUVA<span style="color:#f92672">$</span>dailyallow))<span style="color:#f92672">/</span><span style="color:#a6e22e">sum</span>(SUVA<span style="color:#f92672">$</span>dailyallow)
<span style="color:#a6e22e">plot</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">length</span>(SUVA<span style="color:#f92672">$</span>dailyallow)<span style="color:#f92672">/</span><span style="color:#a6e22e">length</span>(SUVA<span style="color:#f92672">$</span>dailyallow), SUVA.DA.lif,
  xlab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;number of claims (in 100%)&#34;</span>, ylab <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;empirical loss size index function&#34;</span>)
<span style="color:#a6e22e">abline</span>(h <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25</span>, v <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.8</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-DA-LIF-1.png" width="672" /></p>
<h3 id="mean-excess-function">
  Mean excess function
  <a class="anchor" href="#mean-excess-function">#</a>
</h3>
<p>This function will return the mean excess function for an arbitrary vector of thresholds <code>u</code> (for instance, 0, 100, 1000 and 10000 here)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">mef <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x, u) {
  mefvector <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>()
  <span style="color:#a6e22e">for </span>(i in u) {
    mefvector <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(mefvector, <span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">pmax</span>(<span style="color:#a6e22e">sort</span>(x) <span style="color:#f92672">-</span> i, <span style="color:#ae81ff">0</span>))<span style="color:#f92672">/</span><span style="color:#a6e22e">length</span>(x[x <span style="color:#f92672">&gt;</span>
      i]))
  }
  <span style="color:#a6e22e">return</span>(mefvector)
}
<span style="color:#a6e22e">mef</span>(SUVA<span style="color:#f92672">$</span>medcosts, <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">1000</span>, <span style="color:#ae81ff">10000</span>))
<span style="color:#75715e">## [1]  1492.765  1709.148  6233.296 18156.631</span>
<span style="color:#a6e22e">mean</span>(SUVA<span style="color:#f92672">$</span>medcosts)
<span style="color:#75715e">## [1] 1443.349</span>
<span style="color:#a6e22e">mean</span>(SUVA<span style="color:#f92672">$</span>medcosts[SUVA<span style="color:#f92672">$</span>medcosts <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>])
<span style="color:#75715e">## [1] 1492.765</span>
</code></pre></div><hr>
<p>The graph is best done with <code>extRemes::mrlplot</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">mrlplot</span>(SUVA<span style="color:#f92672">$</span>medcosts[SUVA<span style="color:#f92672">$</span>medcosts <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>])
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-MC-mef-1.png" width="672" /></p>
<p>Linear increases point towards a heavy tailed distribution. Here the
graph is biased because dominated by a few very large claims.</p>
<hr>
<p>If we restrict the graph to range up to 20000 (which is roughly 99% of the data) we get:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">mrlplot</span>(SUVA<span style="color:#f92672">$</span>medcosts[SUVA<span style="color:#f92672">$</span>medcosts <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>], xlim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">250</span>, <span style="color:#ae81ff">20000</span>))
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-MC-mef2-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">mrlplot</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>])
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-DA-mef-1.png" width="672" /></p>
<p>This is not as heavy tailed.</p>
<h2 id="quantiles">
  Quantiles
  <a class="anchor" href="#quantiles">#</a>
</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">quantile</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>])
</code></pre></div><pre><code>##       0%      25%      50%      75%     100% 
##     26.0    842.0   1763.0   4841.5 186850.0
</code></pre>
<p>One can also focus on particular quantiles:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">quantile</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>], probs <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.75</span>,
  <span style="color:#ae81ff">0.95</span>, <span style="color:#ae81ff">0.99</span>))
</code></pre></div><pre><code>##     75%     95%     99% 
##  4841.5 25140.5 93285.0
</code></pre>
<p>Note this corresponds to Values at Risk (“VaR”s).</p>
<h2 id="boxplots">
  Boxplots
  <a class="anchor" href="#boxplots">#</a>
</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">boxplot</span>(<span style="color:#a6e22e">list</span>(`Medical costs` <span style="color:#f92672">=</span> SUVA<span style="color:#f92672">$</span>medcosts[SUVA<span style="color:#f92672">$</span>medcosts <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>], `Daily allowance` <span style="color:#f92672">=</span> SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]))
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-boxplot-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">boxplot</span>(<span style="color:#a6e22e">list</span>(`Medical costs` <span style="color:#f92672">=</span> <span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>medcosts[SUVA<span style="color:#f92672">$</span>medcosts <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]), `Daily allowance` <span style="color:#f92672">=</span> <span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>])))
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-boxplotlog-1.png" width="672" /></p>
<h2 id="log-log-plots">
  Log-log plots
  <a class="anchor" href="#log-log-plots">#</a>
</h2>
<p>The log-log plot is defined as
$$ y \rightarrow \left[ \log y, \log (1-G(y))\right],$$
where <code>\(G\)</code> is simply replaced by <code>\(\hat{G}\)</code> for the empirical version.</p>
<p>Just as for the (empirical) mean-excess plots, a linear behaviour (now decreasing) in the (empirical) log-log plot suggests a heavy-tailed distribution. Typical log-log plots are as in Figure 3.19 of Wuthrich (2020).</p>
<h3 id="suva-log-log-plots">
  SUVA log-log plots
  <a class="anchor" href="#suva-log-log-plots">#</a>
</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">emplot</span>(SUVA<span style="color:#f92672">$</span>medcosts[SUVA<span style="color:#f92672">$</span>medcosts <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>], alog <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;xy&#34;</span>, labels <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-MC-loglog-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">emplot</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>], alog <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;xy&#34;</span>, labels <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-DA-loglog-1.png" width="672" /></p>
<p>Again, medical costs are a good candidate for heavy tailed distributions (graph is more linear, except at the very end), whereas daily
allowance is more reasonably behaved (graph is more concave).</p>
<p>In what follows we will focus on the fitting of daily allowance costs. Medical costs will be modelled in Module 6.</p>
<h1 id="selected-parametric-claims-size-distributions-mw-32">
  Selected parametric claims size distributions (MW 3.2)
  <a class="anchor" href="#selected-parametric-claims-size-distributions-mw-32">#</a>
</h1>
<h2 id="parametric-models-for-severity-y">
  Parametric models for severity <code>\(Y\)</code>
  <a class="anchor" href="#parametric-models-for-severity-y">#</a>
</h2>
<h3 id="gamma">
  Gamma
  <a class="anchor" href="#gamma">#</a>
</h3>
<ul>
<li>We shall write <code>\(Y\sim \Gamma\left( \alpha ,\beta \right)\)</code> if density has the form
<code>$$g\left( y\right) =\frac{\beta ^{\alpha }}{\Gamma \left( \alpha \right) }y^{\alpha -1}e^{-\beta y}\text{, for }y&gt;0\text{; }\alpha ,\beta&gt;0\text{.}$$</code></li>
<li>Mean: <code>\(E\left( Y\right) =\alpha /\beta\)</code></li>
<li>Variance: <code>\(Var\left( Y\right) =\alpha /\beta ^{2}\)</code></li>
<li>Skewness: <code>\(\varsigma_Y=2/\sqrt{\alpha }\)</code> [positively skewed distribution]</li>
<li>Mgf: <code>\(M_{Y}\left( t\right) =\left( \dfrac{\beta }{\beta-t}\right) ^{\alpha }\)</code>, provided <code>\(t &lt; \beta\)</code> .</li>
<li>Higher moments: <code>\(E\left( Y^{k}\right) =\dfrac{\Gamma \left(\alpha +k\right) }{\Gamma \left( \alpha \right) \beta ^{k}}\)</code></li>
<li>Special case: When <code>\(\alpha =1\)</code>, we have $YExp() $</li>
</ul>
<h3 id="inverse-gaussian">
  Inverse Gaussian
  <a class="anchor" href="#inverse-gaussian">#</a>
</h3>
<ul>
<li>We shall write $YIG( ,) $ if density has the form
<code>$$g\left( y\right) =\frac{\alpha y^{-3/2}}{\sqrt{2\pi \beta }}\exp \left[ -\frac{\left( \alpha -\beta y\right) ^{2}}{2\beta y}\right] \text{, for }y&gt;0\text{; }\alpha ,\beta &gt;0\text{.}$$</code></li>
<li>Mean: <code>\(E\left( Y\right) =\alpha / \beta\)</code></li>
<li>Variance: <code>\(Var\left( Y\right) =\alpha /\beta ^{2}\)</code></li>
<li>Skewness: <code>\(\varsigma_Y=3/\sqrt{\alpha }\)</code> [positively skewed distribution]</li>
<li>Mgf: <code>\(M_{Y}\left( t\right) =e^{\alpha \left( 1-\sqrt{1-2t/\beta }\right) }\)</code>, provided <code>\(t &lt; \beta /2\)</code> .</li>
<li>The term “Inverse Gaussian” comes from the fact that there is an inverse relationship between its cgf and that of the Gaussian distribution, but NOT from the
fact that the inverse is Gaussian!</li>
</ul>
<h3 id="weibull">
  Weibull
  <a class="anchor" href="#weibull">#</a>
</h3>
<ul>
<li>We shall write <code>\(Y\sim \text{Weibull}\left(\tau,c \right)\)</code> if density has the form
<code>$$g\left( y\right) = (c\tau) (cy)^{\tau-1} \exp \{-(cy)^\tau\} \text{, for }y\ge 0\text{; }\alpha ,\beta&gt;0\text{.}$$</code>
Note <code>\(G(u)=1-\exp\{-(cy)^\tau\}\)</code>.</li>
<li>Mean: <code>\(E\left( Y\right) =\frac{\gamma(1+1/\tau)}{c}\)</code></li>
<li>Variance: <code>\(Var\left( Y\right) =\frac{\gamma(1+2/\tau)}{c^2}-\mu_Y^2\)</code></li>
<li>Skewness: <code>\(\varsigma_Y= \left[ \frac{\gamma(1+2/\tau)}{c^2} - 3\mu_Y\sigma_Y^2-\mu_Y^3\right]/ \sigma_Y^3\)</code></li>
<li>Mgf: does not exist for <code>\(\tau&lt;1\)</code> and <code>\(t&gt;0\)</code>.</li>
<li>Higher moments: <code>\(E\left( Y^{k}\right) =\frac{\gamma(1+k/\tau)}{c^k}\)</code></li>
<li>Note: if <code>\(Z\sim\text{expo}(1)\)</code> then <code>\(Z^{1/\tau}/c\sim \text{Weibull}\left(\tau,c \right)\)</code>.</li>
</ul>
<h3 id="lognormal">
  Lognormal
  <a class="anchor" href="#lognormal">#</a>
</h3>
<ul>
<li>We shall write <code>\(Y\sim \text{LN}\left(\mu, \sigma^2 \right)\)</code> and we have
<code>$$\log Y \sim \mathcal{N}(\mu,\sigma^2).$$</code></li>
<li>Mean: <code>\(E\left( Y\right) =\exp\{\mu+\sigma^2/2\}\)</code></li>
<li>Variance: <code>\(Var\left( Y\right) =\exp\{2\mu+\sigma^2\}\left(\exp\{\sigma^2\}-1\right)\)</code></li>
<li>Skewness: <code>\(\varsigma_Y= \left(\exp\{\sigma^2\}+2\right)\left(\exp\{\sigma^2\}-1\right)^{1/2}\)</code></li>
<li>Mgf: does not exist for <code>\(t&gt;0\)</code>.</li>
</ul>
<h3 id="log-gamma">
  Log-gamma
  <a class="anchor" href="#log-gamma">#</a>
</h3>
<ul>
<li>We shall write <code>\(\log Y\sim \Gamma\left(\gamma, c \right)\)</code> and we have
<code>$$g\left( y\right) =\frac{c ^{\gamma }}{\Gamma \left( \gamma \right) }(\log y)^{\gamma -1}y^{-(c+1)}\text{, for }y&gt;0\text{; }\alpha ,\beta&gt;0\text{.}$$</code></li>
<li>Mean: <code>\(E\left( Y\right) =\left(\frac{c}{c-1}\right)^\gamma\)</code> for <code>\(c&gt;1\)</code></li>
<li>Variance: <code>\(Var\left( Y\right) =\left(\frac{c}{c-2}\right)^\gamma -\mu_Y^2\)</code> for <code>\(c&gt;2\)</code></li>
<li>Skewness: <code>\(\varsigma_Y=\left[ \left(\frac{c}{c-3}\right)^\gamma - 3\mu_Y\sigma_Y^2-\mu_Y^3\right]/ \sigma_Y^3\)</code></li>
<li>Mgf: does not exist for <code>\(t&gt;0\)</code>.</li>
<li>Higher moments: <code>\(E\left( Y^{k}\right) =\left(\frac{c}{c-k}\right)^\gamma\)</code> for <code>\(c&gt;k\)</code></li>
<li>Special case: When <code>\(\alpha =1\)</code>, we have <code>\(Y\sim Exp\left(\beta \right)\)</code></li>
</ul>
<h3 id="pareto-distribution">
  Pareto Distribution
  <a class="anchor" href="#pareto-distribution">#</a>
</h3>
<ul>
<li>We shall write <code>\(Y\sim Pareto\left( \theta, \alpha \right)\)</code> if density has the form
<code>$$g\left( y\right) = \frac{\alpha}{\theta}\left(\frac{y}{\theta}\right)^{-(\alpha+1)}   \quad\text{for }\alert{y\ge \theta}$$</code></li>
<li>Mean: <code>\(E\left( Y\right) =\theta \frac{\alpha}{\alpha-1}\)</code>, <code>\(\alpha&gt;1\)</code></li>
<li>Variance: <code>\(Var\left( Y\right) =\theta^2 \frac{\alpha}{(\alpha-1)^2(\alpha-2)}\)</code>, <code>\(\alpha&gt;2\)</code></li>
<li>Skewness: <code>\(\varsigma_Y=\frac{2(1+\alpha)}{\alpha-3}\left(\frac{\alpha-2}{\alpha}\right)^{1/2}\)</code>, <code>\(\alpha&gt;3\)</code></li>
<li>Mgf: does not exist for <code>\(t&gt;0\)</code></li>
<li>Translated Pareto: distribution of <code>\(Y=Y-\beta\)</code></li>
</ul>
<h2 id="extreme-value-theory">
  Extreme Value Theory
  <a class="anchor" href="#extreme-value-theory">#</a>
</h2>
<p>Note that the following topics (which appear briefly in MW 3) will be covered in Module 6 on Extreme Value Theory:</p>
<ul>
<li>regular variation at infinity and tail index (page 58-59+)</li>
<li>Hill plot (page 75+)</li>
<li>Generalised Pareto (“GP”) and Generalised Extreme Value (“GEV”) distributions</li>
</ul>
<h1 id="fitting-of-distributions-mw32">
  Fitting of distributions (MW3.2)
  <a class="anchor" href="#fitting-of-distributions-mw32">#</a>
</h1>
<h2 id="introduction-1">
  Introduction
  <a class="anchor" href="#introduction-1">#</a>
</h2>
<ul>
<li>By now, the modeller should have identified some candidate parametric distributions for their data set.
<ul>
<li>Example: for <code>SUVA$dailyallow</code>, based on data numerical and graphical explorations, we decided to try gamma, lognormal, and Weibull.</li>
</ul>
</li>
<li>In order to be able to compare them, that is, assess their goodness of fit (which will be discussed in the next section), one must find numerical values for the parameters of the candidates.</li>
<li>The parameter values we will choose will depend on some criterion, which the modeller can choose. In some cases, they may even want to follow different approaches and choose which is the one they think works best for their purposes.</li>
</ul>
<hr>
<ul>
<li>Fitting criteria include:
<ul>
<li>moment matching: choose the <code>\(m\)</code> parameters such that the first <code>\(m\)</code> moments match</li>
<li>maximum likelihood: choose the parameters such that the overall likelihood that the model generated the data is maximal</li>
<li><code>\(\adv\)</code> maximum goodness: choose the parameters such that some goodness of fit criterion is maximised</li>
</ul>
</li>
<li>We will discuss the first two here, and the third after the goodness of fit section (for obvious reasons).</li>
</ul>
<hr>
<ul>
<li>There are other criteria which we will not discuss in details, such as:
<ul>
<li>quantile matching: choose parameters such that empirical quantiles match theoretical quantiles</li>
<li>least squares: choose parameters such that the “sum of squares” is minimal (this corresponds to maximum likelihood for Gaussian random variables)</li>
<li>so-called “minimum distance estimation,” which minimises distances between certain theoretical and empirical functions; see <code>actuar::mde</code>. For instance the <code>actuar</code> Cramér-von Mises method minimises the (weighted) distance between empirical and theoretical cdf’s</li>
<li>score functions such as considered in probabilistic forecasting; see, e.g., package <code>scoringRules</code> in Jordan, Krüger, and Lerch (2019)</li>
</ul>
</li>
</ul>
<h3 id="r-and-technical-notes">
  R and technical notes
  <a class="anchor" href="#r-and-technical-notes">#</a>
</h3>
<ul>
<li>The function <code>MASS::fitdist</code> is standard, and uses by default MLE via the <code>optim</code> function.</li>
<li>The package <code>fitdistrplus</code> allows other fitting criteria (such as method of moments and maximum goodness), and also allows for the user to supply their own optimisation function.</li>
<li>Distributions are coded in the following way. For distribution <code>foo</code>:
<ul>
<li><code>dfoo</code> is the density (pdf) of <code>foo</code></li>
<li><code>pfoo</code> is the distribution function (cdf) of <code>foo</code></li>
<li><code>qfoo</code> is the quantile function of <code>foo</code></li>
<li><code>rfoo</code> is the random number generator of <code>foo</code></li>
</ul>
</li>
<li>
  <a href="https://cran.r-project.org/web/views/Distributions.html">This link</a> provides a very comprehensive list of available distributions in R. As a user you can define any distribution yourself, and this syntax will be recognised by some functions.</li>
<li>The package <code>actuar</code> provides additional distributions. It also automates the transformation of such distribution functions
in presence of left-truncation and right-censoring (more later).</li>
</ul>
<h2 id="moment-matching-estimation-mme">
  Moment matching estimation (MME)
  <a class="anchor" href="#moment-matching-estimation-mme">#</a>
</h2>
<ul>
<li>This is quite straightforward; for a distribution of <code>\(m\)</code> parameters:
<ul>
<li>choose <code>\(m\)</code> moments you care about (usually the first <code>\(m\)</code> moments around the origin or the mean);</li>
<li>build a system of <code>\(m\)</code> equations (for the <code>\(m\)</code> parameters) matching empirical moments of your choice;</li>
<li>solve the system (might require a computer or some numerical techniques if the equations are not linear).</li>
</ul>
</li>
<li>In R, set the argument <code>method</code> to <code>mme</code> in the call to <code>fitdist</code>
<ul>
<li>For distributions of 1 and 2 parameters, mean and variances are matched</li>
<li>For a certain number of distributions a closed form formula is used. For the others, equations are solved numerically using <code>optim</code> and by minimising the sum of squared differences between theoretical and observed moments.</li>
</ul>
</li>
</ul>
<h3 id="mme-for-suva">
  MME for SUVA
  <a class="anchor" href="#mme-for-suva">#</a>
</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.lnorm.mme <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]), <span style="color:#e6db74">&#34;lnorm&#34;</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mme&#34;</span>, order <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>)
fit.lnorm.mme<span style="color:#f92672">$</span>estimate
</code></pre></div><pre><code>##   meanlog     sdlog 
## 2.0146490 0.1871132
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.lnorm.mme<span style="color:#f92672">$</span>loglik
</code></pre></div><pre><code>## [1] -1959.06
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.lnorm.mme2 <span style="color:#f92672">&lt;-</span> fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">mmedist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]), <span style="color:#e6db74">&#34;lnorm&#34;</span>, order <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>)
fit.lnorm.mme2<span style="color:#f92672">$</span>estimate
</code></pre></div><pre><code>##   meanlog     sdlog 
## 2.0146490 0.1871132
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.lnorm.mme2<span style="color:#f92672">$</span>loglik
</code></pre></div><pre><code>## [1] -1959.06
</code></pre>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.gamma.mme <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]), <span style="color:#e6db74">&#34;gamma&#34;</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mme&#34;</span>, order <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>)
fit.gamma.mme<span style="color:#f92672">$</span>estimate
</code></pre></div><pre><code>##     shape      rate 
## 28.065081  3.678009
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.gamma.mme<span style="color:#f92672">$</span>loglik
</code></pre></div><pre><code>## [1] -1951.838
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># function to calculate sample raw moment</span>
memp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x, order) <span style="color:#a6e22e">emm</span>(x, order)
fit.weibull.mme <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]), <span style="color:#e6db74">&#34;weibull&#34;</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mme&#34;</span>, memp <span style="color:#f92672">=</span> memp, order <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>,
  <span style="color:#ae81ff">2</span>))
fit.weibull.mme<span style="color:#f92672">$</span>estimate
</code></pre></div><pre><code>##    shape    scale 
## 6.172910 8.212158
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.weibull.mme<span style="color:#f92672">$</span>loglik
</code></pre></div><pre><code>## [1] -2020.119
</code></pre>
<h2 id="maximum-likelihood-estimation-mle">
  Maximum likelihood estimation (MLE)
  <a class="anchor" href="#maximum-likelihood-estimation-mle">#</a>
</h2>
<ul>
<li>The likelihood for a statistical model gives an indication of how likely it is that this data set was generated, should the model be correct.</li>
<li>If there is no censoring or truncation, we have
Obviously, this is a function of the parameter (vector) <code>\(\mathbf{\theta }=\left( \theta _{1},...,\theta_{m}\right)\)</code>, for a given set of observations, denoted <code>\(\mathbf{x}=\left(x_{1},...,x_{n}\right)\)</code>.</li>
<li>The value <code>\(\widehat{\mathbf{\theta }}\)</code> that maximises the likelihood is called the maximum likelihood estimator (MLE).</li>
<li>Often, it is more convenient to maximise the log-likelihood function given by
This avoids issues of underflow for <code>\(L\)</code> when <code>\(n\)</code> is large.</li>
</ul>
<hr>
<p>Note:</p>
<ul>
<li>The formulation of a likelihood in presence of left-tuncation and right-censoring will be covered in a later section.</li>
<li>Sometimes, MLEs match MMEs (check book).</li>
<li>MLEs have nice properties (such as asymptotic normality, which is one way to estimate standard errors; see later).</li>
</ul>
<h3 id="mle-for-suva">
  MLE for SUVA
  <a class="anchor" href="#mle-for-suva">#</a>
</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.lnorm.mle <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]), <span style="color:#e6db74">&#34;lnorm&#34;</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mle&#34;</span>)
fit.lnorm.mle<span style="color:#f92672">$</span>estimate
</code></pre></div><pre><code>##   meanlog     sdlog 
## 2.0140792 0.1918442
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.lnorm.mle<span style="color:#f92672">$</span>loglik
</code></pre></div><pre><code>## [1] -1958.359
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.gamma.mle <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]), <span style="color:#e6db74">&#34;gamma&#34;</span>)
fit.gamma.mle<span style="color:#f92672">$</span>estimate
</code></pre></div><pre><code>##     shape      rate 
## 27.825788  3.646718
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.gamma.mle<span style="color:#f92672">$</span>loglik
</code></pre></div><pre><code>## [1] -1951.818
</code></pre>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.weibull.mle <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]), <span style="color:#e6db74">&#34;weibull&#34;</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mle&#34;</span>)
fit.weibull.mle<span style="color:#f92672">$</span>estimate
</code></pre></div><pre><code>##    shape    scale 
## 5.527347 8.231313
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.weibull.mle<span style="color:#f92672">$</span>loglik
</code></pre></div><pre><code>## [1] -2003.26
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">summary</span>(fit.weibull.mle)
</code></pre></div><pre><code>## Fitting of the distribution ' weibull ' by maximum likelihood 
## Parameters : 
##       estimate Std. Error
## shape 5.527347 0.12127037
## scale 8.231313 0.04760155
## Loglikelihood:  -2003.26   AIC:  4010.519   BIC:  4020.524 
## Correlation matrix:
##           shape     scale
## shape 1.0000000 0.3301744
## scale 0.3301744 1.0000000
</code></pre>
<h2 id="parameter-uncertainty">
  Parameter uncertainty
  <a class="anchor" href="#parameter-uncertainty">#</a>
</h2>
<ul>
<li>The estimation of parameters is not perfect.</li>
<li>The mere fact that different methods lead to different estimates makes that point obvious.</li>
<li>This will always be true even if we are fitting the right distribution, just because we have only a finite sample of data</li>
<li>How far can we be from the “truth” ?</li>
<li>There are different ways of answering that question, two of which we discuss here:
<ul>
<li>the Wald approximation: standard errors via the Hessian for MLEs</li>
<li>bootstrap</li>
</ul>
</li>
</ul>
<h3 id="hessian-matrix">
  Hessian matrix
  <a class="anchor" href="#hessian-matrix">#</a>
</h3>
<ul>
<li>The score (or gradient) vector consists of first derivatives</li>
</ul>
<p><code>$$\begin{array} S\left( \mathbf{\theta };\mathbf{x}\right) =\left( \frac{\partial \ell \left( \mathbf{\theta };\mathbf{x}\right) }{\partial \theta_{1}},...,\frac{\partial \ell \left( \mathbf{\theta };\mathbf{x}\right) }{\partial \theta_{m}}\right) ^{\prime }, \end{array}$$</code></p>
<p>so that the MLE satisfies F.O.C. <code>\(S\left(\widehat{\mathbf{\theta}};\mathbf{ x}\right) =\mathbf{0=}\left(0,...,0\right)^{\prime}\)</code>.</p>
<ul>
<li>The <code>\(m\times m\)</code> Hessian matrix for <code>\(\ell\left(\mathbf{\theta};\mathbf{x}\right)\)</code> is defined by</li>
</ul>
<p><code>$$\begin{array} H\left( \mathbf{\theta };\mathbf{x}\right) =\frac{\partial ^{2}\ell \left( \mathbf{\theta };\mathbf{x}\right) }{\partial \mathbf{\theta}\partial \mathbf{\theta }^{\prime }} =\begin{bmatrix} \dfrac{\partial ^{2}\ell \left( \mathbf{\theta };\mathbf{x}\right)}{\partial \theta _{1}^{2}} &amp; \cdots  &amp; \dfrac{\partial ^{2}\ell \left(\mathbf{\theta };\mathbf{x}\right) }{\partial \theta _{1}\partial\theta _{m}} \\ \vdots  &amp; \ddots  &amp; \vdots  \\ \dfrac{\partial ^{2}\ell \left( \mathbf{\theta };\mathbf{x}\right) }{\partial \theta _{m}\partial \theta _{1}} &amp; \cdots  &amp; \dfrac{\partial^{2}\ell \left( \mathbf{\theta };\mathbf{x}\right) }{\partial \theta_{m}^{2} } \end{bmatrix}. \end{array}$$</code></p>
<ul>
<li>This Hessian is used to estimate <code>\(Var\left(\widehat{\mathbf{\theta}}\right)\)</code>.</li>
<li>Minus the expected value of this is called the (expected) Fisher information.</li>
</ul>
<h3 id="the-wald-approximation">
  The Wald approximation
  <a class="anchor" href="#the-wald-approximation">#</a>
</h3>
<p>It is well-known that a consistent estimator for the covariance matrix <code>\(Var\left(\widehat{\mathbf{\theta}}\right)\)</code> is given by the inverse of the negative of this Hessian matrix:</p>
<p><code>$$\begin{array} \text{Var}\left(\widehat{\mathbf{\theta}}\right)\ge \widehat{\text{Var}}\left( \widehat{\mathbf{\theta }}\right) =\left[-\mathbf{E}[H\left( \widehat{\mathbf{\theta }};\mathbf{x}\right) ]\right] ^{-1}. \end{array}$$</code></p>
<p>The square root of the diagonal elements of this covariance estimate give the standard errors of the MLE estimates.
Note:</p>
<ul>
<li>“Consistent” means it converges in probability to the value being estimated.</li>
<li>When <code>\(n\rightarrow \infty\)</code>, the distribution of <code>\(\hat{\theta}\)</code> is asymptotically normal.</li>
<li>Note these are <em>asymptotic</em> results. Furthermore, their quality also strongly depends on the data, the distribution, and the parametrisation of the distribution.</li>
</ul>
<h3 id="standard-errors-for-suva-data">
  Standard errors for SUVA data
  <a class="anchor" href="#standard-errors-for-suva-data">#</a>
</h3>
<p>Note these are obviously unavailable for MMEs. For MLEs:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.lnorm.mle<span style="color:#f92672">$</span>sd
</code></pre></div><pre><code>##     meanlog       sdlog 
## 0.005786951 0.004091492
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">summary</span>(fit.lnorm.mle)
</code></pre></div><pre><code>## Fitting of the distribution ' lnorm ' by maximum likelihood 
## Parameters : 
##          estimate  Std. Error
## meanlog 2.0140792 0.005786951
## sdlog   0.1918442 0.004091492
## Loglikelihood:  -1958.359   AIC:  3920.717   BIC:  3930.722 
## Correlation matrix:
##         meanlog sdlog
## meanlog       1     0
## sdlog         0     1
</code></pre>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.gamma.mle<span style="color:#f92672">$</span>sd
</code></pre></div><pre><code>##     shape      rate 
## 1.1799871 0.1560433
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">summary</span>(fit.gamma.mle)
</code></pre></div><pre><code>## Fitting of the distribution ' gamma ' by maximum likelihood 
## Parameters : 
##        estimate Std. Error
## shape 27.825788  1.1799871
## rate   3.646718  0.1560433
## Loglikelihood:  -1951.818   AIC:  3907.636   BIC:  3917.641 
## Correlation matrix:
##         shape    rate
## shape 1.00000 0.99103
## rate  0.99103 1.00000
</code></pre>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.weibull.mle<span style="color:#f92672">$</span>sd
</code></pre></div><pre><code>##      shape      scale 
## 0.12127037 0.04760155
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">summary</span>(fit.weibull.mle)
</code></pre></div><pre><code>## Fitting of the distribution ' weibull ' by maximum likelihood 
## Parameters : 
##       estimate Std. Error
## shape 5.527347 0.12127037
## scale 8.231313 0.04760155
## Loglikelihood:  -2003.26   AIC:  4010.519   BIC:  4020.524 
## Correlation matrix:
##           shape     scale
## shape 1.0000000 0.3301744
## scale 0.3301744 1.0000000
</code></pre>
<h2 id="adv-bootstrap">
  <code>\(\adv\)</code> Bootstrap
  <a class="anchor" href="#adv-bootstrap">#</a>
</h2>
<ul>
<li>It is advisable to compare the Wald approximation to the ones obtained using bootstrap procedures.</li>
<li>Also, the Wald approximation assumes elliptical loglikelihood contours (related to the Gaussian asymptotic result), and hence having a look at the loglikelihood contours is also informative.</li>
<li>More generally, one might want to simply use bootstrap to compute confidence intervals on parameters (or any function of those parameters).</li>
<li>In R:
<ul>
<li><code>llplot</code> will provide the loglikelihood contours; and</li>
<li><code>bootdist</code> will provide bootstrap results on a fitted object.</li>
</ul>
</li>
</ul>
<h3 id="adv-suva-contours-and-bootstrap-results">
  <code>\(\adv\)</code> SUVA contours and bootstrap results
  <a class="anchor" href="#adv-suva-contours-and-bootstrap-results">#</a>
</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">llplot</span>(fit.lnorm.mle)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-llplot-lnorm-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.lnorm.mle.boot <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">bootdist</span>(fit.lnorm.mle, niter <span style="color:#f92672">=</span> <span style="color:#ae81ff">1001</span>)
fit.lnorm.mle.boot<span style="color:#f92672">$</span>fitpart  <span style="color:#75715e"># the Wald approximation</span>
</code></pre></div><pre><code>## Fitting of the distribution ' lnorm ' by maximum likelihood 
## Parameters:
##          estimate  Std. Error
## meanlog 2.0140792 0.005786951
## sdlog   0.1918442 0.004091492
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">summary</span>(fit.lnorm.mle.boot)
</code></pre></div><pre><code>## Parametric bootstrap medians and 95% percentile CI 
##            Median      2.5%     97.5%
## meanlog 2.0138122 2.0030576 2.0254507
## sdlog   0.1916986 0.1831389 0.1997909
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># CI to be compared with</span>
fit.lnorm.mle<span style="color:#f92672">$</span>estimate <span style="color:#f92672">+</span> <span style="color:#a6e22e">cbind</span>(estimate <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, `2.5%` <span style="color:#f92672">=</span> <span style="color:#ae81ff">-1.96</span> <span style="color:#f92672">*</span>
  fit.lnorm.mle<span style="color:#f92672">$</span>sd, `97.5%` <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.96</span> <span style="color:#f92672">*</span> fit.lnorm.mle<span style="color:#f92672">$</span>sd)
</code></pre></div><pre><code>##          estimate      2.5%     97.5%
## meanlog 2.0140792 2.0027368 2.0254216
## sdlog   0.1918442 0.1838249 0.1998635
</code></pre>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">plot</span>(fit.lnorm.mle.boot)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-boot-lnorm2-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">llplot</span>(fit.gamma.mle)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-llplot-gamma-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.gamma.mle.boot <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">bootdist</span>(fit.gamma.mle, niter <span style="color:#f92672">=</span> <span style="color:#ae81ff">1001</span>)
fit.gamma.mle.boot<span style="color:#f92672">$</span>fitpart  <span style="color:#75715e"># the Wald approximation</span>
</code></pre></div><pre><code>## Fitting of the distribution ' gamma ' by maximum likelihood 
## Parameters:
##        estimate Std. Error
## shape 27.825788  1.1799871
## rate   3.646718  0.1560433
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">summary</span>(fit.gamma.mle.boot)
</code></pre></div><pre><code>## Parametric bootstrap medians and 95% percentile CI 
##          Median      2.5%     97.5%
## shape 27.858786 25.708293 30.215199
## rate   3.649776  3.361932  3.949252
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># CI to be compared with</span>
fit.gamma.mle<span style="color:#f92672">$</span>estimate <span style="color:#f92672">+</span> <span style="color:#a6e22e">cbind</span>(estimate <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, `2.5%` <span style="color:#f92672">=</span> <span style="color:#ae81ff">-1.96</span> <span style="color:#f92672">*</span>
  fit.gamma.mle<span style="color:#f92672">$</span>sd, `97.5%` <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.96</span> <span style="color:#f92672">*</span> fit.gamma.mle<span style="color:#f92672">$</span>sd)
</code></pre></div><pre><code>##        estimate      2.5%     97.5%
## shape 27.825788 25.513014 30.138563
## rate   3.646718  3.340873  3.952562
</code></pre>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">plot</span>(fit.gamma.mle.boot)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-boot-gamma2-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">llplot</span>(fit.weibull.mle)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-llplot-weibull-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.weibull.mle.boot <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">bootdist</span>(fit.weibull.mle, niter <span style="color:#f92672">=</span> <span style="color:#ae81ff">1001</span>)
fit.weibull.mle.boot<span style="color:#f92672">$</span>fitpart  <span style="color:#75715e"># the Wald approximation</span>
</code></pre></div><pre><code>## Fitting of the distribution ' weibull ' by maximum likelihood 
## Parameters:
##       estimate Std. Error
## shape 5.527347 0.12127037
## scale 8.231313 0.04760155
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">summary</span>(fit.weibull.mle.boot)
</code></pre></div><pre><code>## Parametric bootstrap medians and 95% percentile CI 
##         Median     2.5%    97.5%
## shape 5.533937 5.278860 5.806541
## scale 8.229892 8.136889 8.319193
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># CI to be compared with</span>
fit.weibull.mle<span style="color:#f92672">$</span>estimate <span style="color:#f92672">+</span> <span style="color:#a6e22e">cbind</span>(estimate <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, `2.5%` <span style="color:#f92672">=</span> <span style="color:#ae81ff">-1.96</span> <span style="color:#f92672">*</span>
  fit.weibull.mle<span style="color:#f92672">$</span>sd, `97.5%` <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.96</span> <span style="color:#f92672">*</span> fit.weibull.mle<span style="color:#f92672">$</span>sd)
</code></pre></div><pre><code>##       estimate     2.5%    97.5%
## shape 5.527347 5.289657 5.765037
## scale 8.231313 8.138014 8.324612
</code></pre>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">plot</span>(fit.weibull.mle.boot)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-boot-weibull2-1.png" width="672" /></p>
<h3 id="adv-confidence-intervals-on-other-quantities">
  <code>\(\adv\)</code> Confidence intervals on other quantities
  <a class="anchor" href="#adv-confidence-intervals-on-other-quantities">#</a>
</h3>
<ul>
<li>One can readily obtain confidence intervals on quantiles with the <code>quantile</code> function and a <code>bootdist</code> object</li>
<li>More generally, this can be done of any function; see Delignette-Muller and Dutang (2015).</li>
</ul>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">quantile</span>(fit.gamma.mle.boot)
</code></pre></div><pre><code>## (original) estimated quantiles for each specified probability (non-censored data)
##             p=0.1    p=0.2    p=0.3    p=0.4    p=0.5    p=0.6
## estimate 5.845174 6.394064 6.810817 7.181091 7.539156 7.908945
##             p=0.7   p=0.8    p=0.9
## estimate 8.317716 8.81358 9.532902
## Median of bootstrap estimates
##             p=0.1    p=0.2    p=0.3    p=0.4    p=0.5   p=0.6   p=0.7
## estimate 5.845315 6.395686 6.810459 7.180947 7.539751 7.90884 8.31787
##             p=0.8    p=0.9
## estimate 8.814295 9.532867
## 
## two-sided 95 % CI of each quantile
##           p=0.1    p=0.2    p=0.3    p=0.4    p=0.5    p=0.6    p=0.7
## 2.5 %  5.742685 6.300067 6.722647 7.091769 7.447182 7.812046 8.215175
## 97.5 % 5.938023 6.479399 6.889012 7.261597 7.624460 7.999226 8.417582
##           p=0.8    p=0.9
## 2.5 %  8.699015 9.400036
## 97.5 % 8.928283 9.676549
</code></pre>
<h2 id="dealing-with-left-truncation-and-right-censoring">
  Dealing with left-truncation and right-censoring
  <a class="anchor" href="#dealing-with-left-truncation-and-right-censoring">#</a>
</h2>
<h3 id="coding-of-censored-data-in-r">
  Coding of censored data in R
  <a class="anchor" href="#coding-of-censored-data-in-r">#</a>
</h3>
<ul>
<li>We need two columns named <code>left</code> and <code>right</code>.</li>
<li>The <code>left</code> column contains:
<ul>
<li><code>NA</code> for left censored observations</li>
<li>the left bound of the interval for interval censored observations</li>
<li>the observed value for non-censored observations</li>
</ul>
</li>
<li>The <code>right</code> column contains:
<ul>
<li><code>NA</code> for right censored observations</li>
<li>the right bound of the interval for interval censored observations</li>
<li>the observed value for non-censored observations</li>
</ul>
</li>
<li>This corresponds to the coding names <code>interval2</code> in function <code>Surv</code> of the package <code>survival</code></li>
</ul>
<hr>
<p>For example, consider twenty values from the <code>canlifins</code> of the <code>CASdatasets</code> package (see Delignette-Muller and Dutang (n.d.))</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">exitage <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">81.1</span>, <span style="color:#ae81ff">78.9</span>, <span style="color:#ae81ff">72.6</span>, <span style="color:#ae81ff">67.9</span>, <span style="color:#ae81ff">60.1</span>, <span style="color:#ae81ff">78.3</span>, <span style="color:#ae81ff">83.4</span>, <span style="color:#ae81ff">66.9</span>,
  <span style="color:#ae81ff">74.8</span>, <span style="color:#ae81ff">80.5</span>, <span style="color:#ae81ff">75.6</span>, <span style="color:#ae81ff">67.1</span>, <span style="color:#ae81ff">75.3</span>, <span style="color:#ae81ff">82.8</span>, <span style="color:#ae81ff">70.1</span>, <span style="color:#ae81ff">85.4</span>, <span style="color:#ae81ff">74</span>, <span style="color:#ae81ff">70</span>, <span style="color:#ae81ff">71.6</span>,
  <span style="color:#ae81ff">76.5</span>)
death <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>,
  <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>)
</code></pre></div><ul>
<li>the first value is someone who exited the study at 81.1, but not via death, so it is a right-censored observation</li>
<li>this needs to be coded:
<ul>
<li><code>left</code>: 81.1</li>
<li><code>right</code>: <code>NA</code></li>
</ul>
</li>
</ul>
<hr>
<p>Overall, this becomes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">casdata <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cbind.data.frame</span>(left <span style="color:#f92672">=</span> exitage, right <span style="color:#f92672">=</span> exitage)
casdata<span style="color:#f92672">$</span>right[death <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>  <span style="color:#75715e"># the censored values</span>
<span style="color:#a6e22e">print</span>(casdata)
</code></pre></div><pre><code>##    left right
## 1  81.1    NA
## 2  78.9    NA
## 3  72.6  72.6
## 4  67.9    NA
## 5  60.1    NA
## 6  78.3    NA
## 7  83.4    NA
## 8  66.9  66.9
## 9  74.8    NA
## 10 80.5    NA
## 11 75.6    NA
## 12 67.1    NA
## 13 75.3    NA
## 14 82.8    NA
## 15 70.1  70.1
## 16 85.4  85.4
## 17 74.0    NA
## 18 70.0    NA
## 19 71.6    NA
## 20 76.5    NA
</code></pre>
<p>(Note: How to use the function <code>Surv()</code> is explained in Delignette-Muller and Dutang, n.d.)</p>
<hr>
<p>Censored data can be plotted raw…</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">plotdistcens</span>(casdata, NPMLE <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/casdata-plot1-1.png" width="672" /></p>
<hr>
<p>… or as an empirical distribution</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">plotdistcens</span>(casdata)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/casdata-plot2-1.png" width="672" /></p>
<p>Note that there are some technical subtleties with creating empirical distributions for censored data. This is out of scope, but details can be found in Delignette-Muller and Dutang (n.d.), Delignette-Muller and Dutang (2015), and references therein.</p>
<h3 id="fitting-censored-data">
  Fitting censored data
  <a class="anchor" href="#fitting-censored-data">#</a>
</h3>
<ul>
<li>Again, this is easily done with associated <code>foocens</code> functions</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">cas.gamma.fit <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdistcens</span>(casdata, <span style="color:#e6db74">&#34;gamma&#34;</span>)
<span style="color:#a6e22e">summary</span>(cas.gamma.fit)
</code></pre></div><pre><code>## Fitting of the distribution ' gamma ' By maximum likelihood on censored data 
## Parameters
##         estimate Std. Error
## shape 57.7413639 41.0308065
## rate   0.6626575  0.5056793
## Loglikelihood:  -20.0179   AIC:  44.0358   BIC:  46.02727 
## Correlation matrix:
##           shape      rate
## shape 1.0000000 0.9983071
## rate  0.9983071 1.0000000
</code></pre>
<ul>
<li>Commands like <code>cdfcompcens</code> <code>bootdistcens</code> also exist.</li>
<li>However, <code>gofstat</code> is not available as there do not exist results
general enough to be coded in the package. Specific results for
right-censored variables do exist, though.</li>
</ul>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">plot</span>(cas.gamma.fit)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/casdata-fit-plot-1.png" width="672" /></p>
<h3 id="left-truncation-and-r">
  Left-truncation and R
  <a class="anchor" href="#left-truncation-and-r">#</a>
</h3>
<ul>
<li>Unfortunately there is no pre-coded function for left-truncation.</li>
<li>It can be done manually, with care.</li>
<li>With left-truncation, the key (from definition) is that an observation will exist, if, <em>and only if</em>, it was beyond the truncation point. This means that the probability/likelihood associated to each observation is <em>conditional</em> on it being more than the truncation point.</li>
<li>What follows is generalised to left- and right- truncation, and is taken from Delignette-Muller and Dutang (n.d.).</li>
<li>For <code>\(X\)</code> before truncation, the <code>\(l\)</code>-left-truncated, <code>\(u\)</code>-right-truncated variable <code>\(Y\)</code> has density
<code>$$g_Y(y)= \left\{ \begin{array}{cl} \frac{g_X(x)}{G_X(u)-G_X(l)} &amp; \text{if }l&lt;x&lt;u \\ 0 &amp; \text{otherwise} \end{array} \right.$$</code></li>
</ul>
<hr>
<p>As an example in R, the <code>d</code> and <code>p</code> functions of a truncated exponential can be coded as:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">dtexp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x, rate, low, upp) {
  PU <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">pexp</span>(upp, rate <span style="color:#f92672">=</span> rate)
  PL <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">pexp</span>(low, rate <span style="color:#f92672">=</span> rate)
  <span style="color:#a6e22e">dexp</span>(x, rate)<span style="color:#f92672">/</span>(PU <span style="color:#f92672">-</span> PL) <span style="color:#f92672">*</span> (x <span style="color:#f92672">&gt;=</span> low) <span style="color:#f92672">*</span> (x <span style="color:#f92672">&lt;=</span> upp)
}
ptexp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(q, rate, low, upp) {
  PU <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">pexp</span>(upp, rate <span style="color:#f92672">=</span> rate)
  PL <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">pexp</span>(low, rate <span style="color:#f92672">=</span> rate)
  (<span style="color:#a6e22e">pexp</span>(q, rate) <span style="color:#f92672">-</span> PL)<span style="color:#f92672">/</span>(PU <span style="color:#f92672">-</span> PL) <span style="color:#f92672">*</span> (q <span style="color:#f92672">&gt;=</span> low) <span style="color:#f92672">*</span> (q <span style="color:#f92672">&lt;=</span> upp) <span style="color:#f92672">+</span>
    <span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> (q <span style="color:#f92672">&gt;</span> upp)
}
</code></pre></div><hr>
<p>If we generate 200 such truncated variables:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">22042021</span>)
n <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">200</span>  <span style="color:#75715e"># number of observations</span>
x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rexp</span>(n)  <span style="color:#75715e"># simulating sample of x&#39;s</span>
y <span style="color:#f92672">&lt;-</span> x[x <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.5</span> <span style="color:#f92672">&amp;</span> x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">3</span>]  <span style="color:#75715e"># truncating to get sample of y&#39;s</span>
</code></pre></div><p>and then fit them with either left- and right- truncation estimated from the data:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.texp.emp <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdist</span>(y, <span style="color:#e6db74">&#34;texp&#34;</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mle&#34;</span>, start <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(rate <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>),
  fix.arg <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(low <span style="color:#f92672">=</span> <span style="color:#a6e22e">min</span>(y), upp <span style="color:#f92672">=</span> <span style="color:#a6e22e">max</span>(y)))
</code></pre></div><p>… or in an informative way (i.e. we know what the bounds are):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.texp.inf <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdist</span>(y, <span style="color:#e6db74">&#34;texp&#34;</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mle&#34;</span>, start <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(rate <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>),
  fix.arg <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(low <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>, upp <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>))
</code></pre></div><hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">gofstat</span>(<span style="color:#a6e22e">list</span>(fit.texp.emp, fit.texp.inf), fitnames <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;unknown bounds&#34;</span>,
  <span style="color:#e6db74">&#34;known bounds&#34;</span>))
</code></pre></div><pre><code>## Goodness-of-fit statistics
##                              unknown bounds known bounds
## Kolmogorov-Smirnov statistic     0.07546318   0.06747339
## Cramer-von Mises statistic       0.13211330   0.09999122
## Anderson-Darling statistic              Inf   0.59863722
## 
## Goodness-of-fit criteria
##                                unknown bounds known bounds
## Akaike's Information Criterion       165.3424     169.7301
## Bayesian Information Criterion       168.1131     172.5007
</code></pre>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">cdfcomp</span>(<span style="color:#a6e22e">list</span>(fit.texp.emp, fit.texp.inf), legendtext <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;unknown bounds&#34;</span>,
  <span style="color:#e6db74">&#34;known bounds&#34;</span>))
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/texp-cdfcomp-1.png" width="672" /></p>
<h3 id="fitting-a-single-level-of-left-trancated-and-right-censored-data">
  Fitting a single level of left-trancated and right-censored data
  <a class="anchor" href="#fitting-a-single-level-of-left-trancated-and-right-censored-data">#</a>
</h3>
<ul>
<li>For our purposes, we shall represent our set of observations as <code>$$\left( t_{j},x_{j},\delta_{j}\right)$$</code> where
<ul>
<li><code>\(t_{j}\)</code> is the left truncation point;</li>
<li><code>\(x_{j}\)</code> is the claim value that produced the data point; and</li>
<li><code>\(\delta_{j}\)</code> is indicator whether limit has been reached.</li>
</ul>
</li>
<li>For example:
<ul>
<li><code>\(\left( 50,250,0\right)\)</code></li>
<li><code>\(\left( 100,1100,1\right)\)</code></li>
</ul>
</li>
</ul>
<hr>
<p>Densities will be as follows:</p>
<p>$$
L\left( \mathbf{\theta };\mathbf{x}\right) =\prod\nolimits_{j}\left[
\frac{ f\left( x_{j};\mathbf{\theta }\right) }{1-F\left(
t_{j};\mathbf{\theta } \right) }\right] ^{1-\delta_{j}}\cdot
\prod\nolimits_{j}\left[ \frac{ 1-F\left( x_{j};\mathbf{\theta
}\right) }{1-F\left( t_{j};\mathbf{\theta } \right) }\right]
^{\delta_{j}}.
$$</p>
<p>The contribution to the likelihood function for a data point where the
limit has not been reached is given by</p>
<p>$$
\left[ \frac{f\left( x_{j}\right) }{1-F\left( t_{j}\right) }\right]
^{1-\delta_{j}}.
$$</p>
<p>The contribution to the likelihood function for a data point where
the limit has been reached is given by</p>
<p>$$
\left[ \frac{1-F\left( x_{j}\right) }{1-F\left( t_{j}\right)
}\right] ^{\delta_{j}}.
$$</p>
<p>Note here that the policy limit if reached would be equal to <code>\(x_{j}-t_{j}\)</code>.</p>
<hr>
<ul>
<li>In R, the approach will be to code a left-truncated function, and then use the <code>foocens</code> functions.</li>
<li>Let us do this on a gamma distribution:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">dtgamma <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x, rate, shape, low) {
  PL <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">pgamma</span>(low, rate <span style="color:#f92672">=</span> rate, shape <span style="color:#f92672">=</span> shape)
  <span style="color:#a6e22e">dgamma</span>(x, rate <span style="color:#f92672">=</span> rate, shape <span style="color:#f92672">=</span> shape)<span style="color:#f92672">/</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> PL) <span style="color:#f92672">*</span> (x <span style="color:#f92672">&gt;=</span> low)
}
ptgamma <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(q, rate, shape, low) {
  PL <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">pgamma</span>(low, rate <span style="color:#f92672">=</span> rate, shape <span style="color:#f92672">=</span> shape)
  (<span style="color:#a6e22e">pgamma</span>(q, rate <span style="color:#f92672">=</span> rate, shape <span style="color:#f92672">=</span> shape) <span style="color:#f92672">-</span> PL)<span style="color:#f92672">/</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> PL) <span style="color:#f92672">*</span> (q <span style="color:#f92672">&gt;=</span>
    low)
}
</code></pre></div><hr>
<p>Simulating one such dataset:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">22042021</span>)
n <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2000</span>  <span style="color:#75715e"># number of observations</span>
x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rgamma</span>(n, shape <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, rate <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>)  <span style="color:#75715e"># simulating sample of x&#39;s</span>
x <span style="color:#f92672">&lt;-</span> x[x <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>]  <span style="color:#75715e"># left-truncation at 2</span>
n <span style="color:#f92672">-</span> <span style="color:#a6e22e">length</span>(x)  <span style="color:#75715e"># observations that were truncated</span>
</code></pre></div><pre><code>## [1] 123
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">censoring <span style="color:#f92672">&lt;-</span> x <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">20</span>  <span style="color:#75715e"># we will censor at 20</span>
x[x <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">20</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">20</span>  <span style="color:#75715e"># censoring at 20</span>
</code></pre></div><hr>
<p>Transforming this into the right format:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">censoring[censoring <span style="color:#f92672">==</span> <span style="color:#66d9ef">FALSE</span>] <span style="color:#f92672">&lt;-</span> x[censoring <span style="color:#f92672">==</span> <span style="color:#66d9ef">FALSE</span>]
censoring[censoring <span style="color:#f92672">==</span> <span style="color:#66d9ef">TRUE</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>
xcens <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">cbind.data.frame</span>(left <span style="color:#f92672">=</span> x, right <span style="color:#f92672">=</span> censoring)
</code></pre></div><p>And fitting:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Not allowing for truncation:</span>
fit.gamma.xcens <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdistcens</span>(xcens, <span style="color:#e6db74">&#34;gamma&#34;</span>, start <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(shape <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(xcens<span style="color:#f92672">$</span>left)^2<span style="color:#f92672">/</span><span style="color:#a6e22e">var</span>(xcens<span style="color:#f92672">$</span>left),
  rate <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(xcens<span style="color:#f92672">$</span>left)<span style="color:#f92672">/</span><span style="color:#a6e22e">var</span>(xcens<span style="color:#f92672">$</span>left)))
<span style="color:#a6e22e">summary</span>(fit.gamma.xcens)
</code></pre></div><pre><code>...
## Fitting of the distribution ' gamma ' By maximum likelihood on censored data 
## Parameters
##        estimate  Std. Error
## shape 2.7153083 0.089141065
## rate  0.2566683 0.009500217
## Loglikelihood:  -5412.521   AIC:  10829.04   BIC:  10840.12 
...
</code></pre>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Allowing for truncation</span>
fit.tgamma.xcens <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdistcens</span>(xcens, <span style="color:#e6db74">&#34;tgamma&#34;</span>, start <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(shape <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(xcens<span style="color:#f92672">$</span>left)^2<span style="color:#f92672">/</span><span style="color:#a6e22e">var</span>(xcens<span style="color:#f92672">$</span>left),
  rate <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(xcens<span style="color:#f92672">$</span>left)<span style="color:#f92672">/</span><span style="color:#a6e22e">var</span>(xcens<span style="color:#f92672">$</span>left)), fix.arg <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(low <span style="color:#f92672">=</span> <span style="color:#a6e22e">min</span>(xcens<span style="color:#f92672">$</span>left)))
<span style="color:#a6e22e">summary</span>(fit.tgamma.xcens)
</code></pre></div><pre><code>...
## Fitting of the distribution ' tgamma ' By maximum likelihood on censored data 
## Parameters
##        estimate Std. Error
## shape 2.0296237 0.10529978
## rate  0.2006534 0.01009728
## Fixed parameters:
##        value
## low 2.013575
## Loglikelihood:  -5340.151   AIC:  10684.3   BIC:  10695.38 
...
</code></pre>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">cdfcompcens</span>(<span style="color:#a6e22e">list</span>(fit.gamma.xcens, fit.tgamma.xcens), legendtext <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Not allowing for truncation&#34;</span>,
  <span style="color:#e6db74">&#34;Allowing for truncation&#34;</span>))
</code></pre></div><!-- To include images: -->
<p><img src="/img/module-3/tgamma-fit4.jpg" width="100%" style="display: block; margin: auto;" /></p>
<!-- ### Case study: Klugman-DataSetB-modified -->
<!-- Summary statistics: -->
<!-- \begin{equation*} -->
<!-- \resizebox{!}{2.5cm}{ -->
<!-- \begin{tabular}{l|lr|rr} -->
<!-- \hline statistic &  & not censored &  & censored \\ \hline\hline -->
<!-- Count &  & 75 &  & 25 \\ -->
<!-- Mean &  & 1,276.47 &  & 2,084.00 \\ -->
<!-- Standard deviation &  & 823.67 &  & 1,174.09 \\ -->
<!-- Variance &  & 678,427.20 &  & 1,378,483.33 \\ -->
<!-- Minimum &  & 182.00 &  & 1,100.00 \\ -->
<!-- 25th percentile &  & 739.50 &  & 1,100.00 \\ -->
<!-- Median &  & 1,131.00 &  & 1,500.00 \\ -->
<!-- 75th percentile &  & 1,560.00 &  & 3,100.00 \\ -->
<!-- Maximum &  & 4,510.00 &  & 5,500.00 \\ -->
<!-- Skewness &  & 1.76 &  & 1.08 \\ -->
<!-- Kurtosis &  & 3.91 &  & 0.38 \\ \hline -->
<!-- \end{tabular}} -->
<!-- \end{equation*} -->
<h3 id="fitting-multiple-levels-of-left-trancated-and-right-censored-data">
  Fitting multiple levels of left-trancated and right-censored data
  <a class="anchor" href="#fitting-multiple-levels-of-left-trancated-and-right-censored-data">#</a>
</h3>
<p>In real life, an insurance product would have more than one level of deductibles and limits to suit different policyholders. Simulating another dataset:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">2022</span>)
n <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">3006</span>  <span style="color:#75715e"># number of observations</span>
x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rgamma</span>(n, shape <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, rate <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>)  <span style="color:#75715e"># simulating sample of x&#39;s</span>
deductibles <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>), <span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>), <span style="color:#a6e22e">rep</span>(<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">3</span>)), <span style="color:#ae81ff">334</span>)
limits <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">30</span>), <span style="color:#ae81ff">3</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">334</span>) <span style="color:#f92672">+</span> deductibles
</code></pre></div><p>Manually applying the deductibles and limits:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">censored <span style="color:#f92672">&lt;-</span> x <span style="color:#f92672">&gt;</span> limits  <span style="color:#75715e"># we will censor at the limits</span>
x[censored] <span style="color:#f92672">&lt;-</span> limits[censored]  <span style="color:#75715e"># censoring at the limits</span>
deducted <span style="color:#f92672">&lt;-</span> x <span style="color:#f92672">&gt;</span> deductibles
x <span style="color:#f92672">&lt;-</span> x[deducted]  <span style="color:#75715e"># left-truncation at all points</span>
n <span style="color:#f92672">-</span> <span style="color:#a6e22e">length</span>(x)  <span style="color:#75715e"># observations that were truncated</span>
</code></pre></div><pre><code>## [1] 431
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">claims <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(x <span style="color:#f92672">=</span> x, deduct <span style="color:#f92672">=</span> deductibles[deducted], limitI <span style="color:#f92672">=</span> censored[deducted])
</code></pre></div><p>Preliminary analysis: (note that there are no claims less than 1)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">claims <span style="color:#f92672">&lt;-</span> claims<span style="color:#a6e22e">[sample</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#a6e22e">nrow</span>(claims), <span style="color:#a6e22e">nrow</span>(claims)), ]  <span style="color:#75715e"># randomising data</span>
<span style="color:#a6e22e">head</span>(claims)
</code></pre></div><pre><code>##              x deduct limitI
## 444  17.196879      1  FALSE
## 1733 13.964488      3  FALSE
## 1414  3.521077      1  FALSE
## 1407 15.488936      1  FALSE
## 1138 11.509672      3  FALSE
## 1977  4.875571      3  FALSE
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">hist</span>(claims<span style="color:#f92672">$</span>x, breaks <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/mult_tgamma-sim3-1.png" width="672" /></p>
<p>Preparing our joint log-likelihood function. Here, we are maximising a negative log-likelihood instead of minimising a log-likelihood.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">negloglik <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(pdf, cdf, param, x, deduct, limitI) {
  <span style="color:#75715e"># Function returns the negative log likelihood of the</span>
  <span style="color:#75715e"># censored and truncated dataset. Each data point&#39;s</span>
  <span style="color:#75715e"># contribution to the log likelihood depends on the</span>
  <span style="color:#75715e"># theoretical distirbution pdf and cdf and also the</span>
  <span style="color:#75715e"># deductible and limit values to adjust for truncation</span>
  <span style="color:#75715e"># and censoring</span>
  PL <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">do.call</span>(cdf, <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">list</span>(q <span style="color:#f92672">=</span> deduct), param))
  PX <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">do.call</span>(cdf, <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">list</span>(q <span style="color:#f92672">=</span> x), param))
  fX <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">do.call</span>(pdf, <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">list</span>(x <span style="color:#f92672">=</span> x), param))
  lik.contr <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ifelse</span>(limitI, <span style="color:#a6e22e">log</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> PX), <span style="color:#a6e22e">log</span>(fX)) <span style="color:#f92672">-</span> <span style="color:#a6e22e">log</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span>
    PL)
  <span style="color:#a6e22e">return</span>(<span style="color:#f92672">-</span><span style="color:#a6e22e">sum</span>(lik.contr))
}
</code></pre></div><p>Fitting the distribution. Note that our objective function needs starting values for the maximisation. What other starting values could we use?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">pdf <span style="color:#f92672">&lt;-</span> dgamma
cdf <span style="color:#f92672">&lt;-</span> pgamma
x <span style="color:#f92672">&lt;-</span> claims<span style="color:#f92672">$</span>x
deduct <span style="color:#f92672">&lt;-</span> claims<span style="color:#f92672">$</span>deduct
limitI <span style="color:#f92672">&lt;-</span> claims<span style="color:#f92672">$</span>limitI
<span style="color:#75715e"># MME for starting values</span>
start <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(shape <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(x)^2<span style="color:#f92672">/</span><span style="color:#a6e22e">var</span>(x), rate <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(x)<span style="color:#f92672">/</span><span style="color:#a6e22e">var</span>(x))
obj.fun <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(shape, rate) {
  param <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">list</span>(shape <span style="color:#f92672">=</span> shape, rate <span style="color:#f92672">=</span> rate)
  <span style="color:#a6e22e">return</span>(<span style="color:#a6e22e">negloglik</span>(pdf, cdf, param, x, deduct, limitI))
}
gamma.ll.fit <span style="color:#f92672">&lt;-</span> stats4<span style="color:#f92672">::</span><span style="color:#a6e22e">mle</span>(obj.fun, start <span style="color:#f92672">=</span> start, lower <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>,
  <span style="color:#ae81ff">0</span>))
<span style="color:#a6e22e">summary</span>(gamma.ll.fit)
</code></pre></div><pre><code>## Length  Class   Mode 
##      1    mle     S4
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">param.g.ll <span style="color:#f92672">&lt;-</span> stats4<span style="color:#f92672">::</span><span style="color:#a6e22e">coef</span>(gamma.ll.fit)
param.g.ll
</code></pre></div><pre><code>##     shape      rate 
## 2.1297568 0.2111871
</code></pre>
<h1 id="model-selection-mw-33">
  Model selection (MW 3.3)
  <a class="anchor" href="#model-selection-mw-33">#</a>
</h1>
<h2 id="graphical-approaches">
  Graphical approaches
  <a class="anchor" href="#graphical-approaches">#</a>
</h2>
<p>For judging quality of model, do some graphical comparisons:</p>
<ul>
<li>histogram vs. fitted parametric density function;</li>
<li>empirical CDF vs fitted parametric CDF;</li>
<li>probability-probability (P-P) plot - theoretical vs empirical cumulative probabilities;</li>
<li>quantile-quantile (Q-Q) plot - theoretical vs sample quantiles.</li>
</ul>
<p>Let the (theoretical) fitted parametric distribution be denoted by
<code>\(G\left( x;\widehat{\mathbf{\theta }}\right)\)</code>.</p>
<h3 id="p-p-plot">
  P-P plot
  <a class="anchor" href="#p-p-plot">#</a>
</h3>
<p>To construct the P-P plot:</p>
<ul>
<li>order the observed data from smallest to largest: <code>\(x_{(1)},x_{(2)},...,x_{(n)}\)</code>.</li>
<li>calculate the theoretical CDF at each of the observed data points: <code>\(G\left( x_{(i)};\widehat{\mathbf{\theta }}\right)\)</code>.</li>
<li>for <code>\(i=1,2,...,n\)</code>, plot the points <code>\(\dfrac{i-0.5}{n}\)</code> against <code>\(G\left(x_{(i)};\widehat{\mathbf{\theta }}\right)\)</code>.</li>
</ul>
<p>Note that using <code>\(\dfrac{i-0.5}{n}\)</code> this is Hazen’s rule, as recommended by Blom (1959).</p>
<p>see also the following video on YouTube:</p>
<ul>
<li>
  <a href="https://www.youtube.com/watch?v=IXyAvKr91as&amp;t=4s">About the choice of <code>\((i-0.5)/n\)</code> in Q-Q and P-P plots</a></li>
</ul>
<h3 id="q-q-plot">
  Q-Q plot
  <a class="anchor" href="#q-q-plot">#</a>
</h3>
<p>To construct the Q-Q plot:</p>
<ul>
<li>order the observed data from smallest to largest: <code>\(x_{(1)},x_{(2)},...,x_{(n)}\)</code>.</li>
<li>for <code>\(i=1,2,...,n\)</code>, calculate the theoretical quantiles: <code>\(G^{-1}\left(\dfrac{i-0.5}{n};\widehat{\mathbf{\theta }}\right)\)</code>.</li>
<li>for <code>\(i=1,2,...,n\)</code>, plot the points <code>\(x_{(i)}\)</code> against <code>\(G^{-1}\left(\dfrac{i-0.5}{n};\widehat{\mathbf{\theta }}\right)\)</code>.</li>
</ul>
<p>These constructions hold only for the case where you have no censoring/truncation.</p>
<p>see also the following video on YouTube:</p>
<ul>
<li>
  <a href="https://www.youtube.com/watch?v=nFFRBHAlRtc">How to build Q-Q plots and P-P plots</a></li>
</ul>
<h3 id="suva-gof-graphs">
  SUVA GOF graphs
  <a class="anchor" href="#suva-gof-graphs">#</a>
</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">plot.legend <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Weibull&#34;</span>, <span style="color:#e6db74">&#34;lognormal&#34;</span>, <span style="color:#e6db74">&#34;gamma&#34;</span>)
fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">denscomp</span>(<span style="color:#a6e22e">list</span>(fit.weibull.mle, fit.lnorm.mle, fit.gamma.mle),
  legendtext <span style="color:#f92672">=</span> plot.legend, fitlwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-GOF-graphs-dens-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">cdfcomp</span>(<span style="color:#a6e22e">list</span>(fit.weibull.mle, fit.lnorm.mle, fit.gamma.mle),
  legendtext <span style="color:#f92672">=</span> plot.legend, fitlwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, datapch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-GOF-graphs-cdf-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">ppcomp</span>(<span style="color:#a6e22e">list</span>(fit.weibull.mle, fit.lnorm.mle, fit.gamma.mle),
  legendtext <span style="color:#f92672">=</span> plot.legend, fitpch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-GOF-graphs-pp-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">qqcomp</span>(<span style="color:#a6e22e">list</span>(fit.weibull.mle, fit.lnorm.mle, fit.gamma.mle),
  legendtext <span style="color:#f92672">=</span> plot.legend, fitpch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-GOF-graphs-qq-1.png" width="672" /></p>
<h2 id="hypothesis-tests">
  Hypothesis tests
  <a class="anchor" href="#hypothesis-tests">#</a>
</h2>
<p>We will test the null</p>
<ul>
<li><code>\(H_{0}:\)</code> data came from population with the specified model, against</li>
<li><code>\(H_{a}:\)</code> the data did not come from such a population.</li>
</ul>
<p>Some commonly used tests, and their test statistics:</p>
<ul>
<li>Kolmogorov-Smirnoff: <code>$$K.S.=\underset{y}{\sup }\left\vert \widehat{G} \left( y\right) -G\left( y;\widehat{\mathbf{\theta }}\right)\right\vert$$</code></li>
<li>Anderson-Darling: <code>$$A.D.=n \int \frac{\left[ \widehat{G}\left( y\right)-G\left( y;\widehat{\mathbf{\theta }}\right) \right] ^{2}}{G\left(y; \widehat{\mathbf{\theta }}\right) \left[ 1-G\left(y;\widehat{\mathbf{\theta }}\right) \right] } dy$$</code></li>
<li><code>\(\chi ^{2}\)</code> goodness-of-fit: <code>$$\chi^{2}=\sum_{j}\frac{\left(\text{observed}-\text{expected}\right) ^{2}}{\text{expected}}$$</code></li>
</ul>
<p>Computational formulas for those tests are available in Delignette-Muller and Dutang (2015).</p>
<h3 id="kolmogorov-smirnoff-test">
  Kolmogorov-Smirnoff test
  <a class="anchor" href="#kolmogorov-smirnoff-test">#</a>
</h3>
<p><code>$$K.S.=\underset{y}{\sup }\left\vert \widehat{G} \left( x\right) -G\left( x;\widehat{\mathbf{\theta }}\right) \right\vert,$$</code>
where</p>
<ul>
<li><code>\(\widehat{G}\left( y\right)\)</code> is the empirical distribution</li>
<li><code>\(G\left( y;\theta \right)\)</code> is the assumed theoretical distribution in the null hypothesis</li>
<li><code>\(G\left( y;\theta \right)\)</code> is assumed to be (must be) continuous</li>
<li><code>\(\hat{\theta}\)</code> is the maximum likelihood estimate for <code>\(\theta\)</code> under the null hypothesis</li>
</ul>
<p>Note:</p>
<ul>
<li>There are tables for the critical values. There are several variations of these tables in the literature that use somewhat different scalings for the K-S test statistic and critical regions.</li>
<li>The test (obviously) does not work for grouped data.</li>
</ul>
<h3 id="anderson-darling-test">
  Anderson-Darling test
  <a class="anchor" href="#anderson-darling-test">#</a>
</h3>
<p><code>$$A.D.=n\int \frac{\left[ \widehat{G}\left( x\right)-G\left( x;\widehat{\mathbf{\theta }}\right) \right] ^{2}}{G\left(x; \widehat{\mathbf{\theta }}\right) \left[ 1-G\left( x;\widehat{\mathbf{\theta }}\right) \right] } dx,$$</code>
where <code>\(n\)</code> is the sample size.</p>
<p>Note:</p>
<ul>
<li>The critical values for the Anderson-Darling test are dependent on the specific distribution that is being tested. There are tabulated values and formulas for a few specific distributions.</li>
<li>The theoretical distribution is assumed to be (must be) continuous.</li>
<li>The test does not work for grouped data.</li>
</ul>
<h3 id="chi-2-goodness-of-fit-test">
  <code>\(\chi ^{2}\)</code> goodness-of-fit test
  <a class="anchor" href="#chi-2-goodness-of-fit-test">#</a>
</h3>
<p>Procedure:</p>
<ul>
<li>Break down the whole range into <code>\(k\)</code> subintervals: <code>\(c_0&lt;c_1&lt;\cdots&lt;c_k=\infty\)</code></li>
<li><code>\(\chi ^{2}\)</code> goodness-of-fit test: <code>\(\chi ^{2}=\sum_{j}^k\frac{(E_j-O_j)^{2}}{E_j}\)</code></li>
<li>Let <code>\(\hat{p_j}=G(c_j;\hat{\theta})-G(c_{j-1};\hat{\theta})\)</code>.
Then, the number of expected observations in the interval <code>\((c_{j-1},c_j]\)</code> assuming that the hypothesized model is true:
<code>$$E_j=n\hat{p}_j \quad \text{(Here, } n \text{ is the sample size)}$$</code></li>
<li>Let <code>\({p_j}=\hat{G}(c_j)-\hat{G}(c_{j-1})\)</code>.
Then, the number of observations in the interval <code>\((c_{j-1},c_j]\)</code> :
$$  O_j=n{p}_j$$</li>
</ul>
<p>The statistic has chi-square distribution with the degree of freedom
equal to: <code>\(k-1- \alert{\text{number of parameters estimated}}\)</code></p>
<h3 id="how-these-tests-are-used">
  How these tests are used
  <a class="anchor" href="#how-these-tests-are-used">#</a>
</h3>
<ul>
<li>Besides testing whether data came from specified model or not, generally we would prefer models with:
<ul>
<li>lowest K-S test statistic</li>
<li>lowest A-D test statistic</li>
<li>lowest <code>\(\chi ^{2}\)</code> goodness-of-fit test statistic (or equivalently highest <code>\(p\)</code>-value)</li>
<li>highest value of the likelihood function at the maximum</li>
</ul>
</li>
<li>Perform formal statistical test, or use as `horse race’</li>
</ul>
<h3 id="comparison">
  Comparison
  <a class="anchor" href="#comparison">#</a>
</h3>
<ul>
<li>K-S and A-D tests are quite similar - both look at the difference
between the empirical and model distribution functions.
<ul>
<li>K-S in absolute value, A-D in squared difference.</li>
<li>But A-D is weighted average, with more emphasis on good fit in the
tails than in the middle; K-S puts no such emphasis.</li>
</ul>
</li>
<li>For K-S and A-D tests, no adjustments are made to account for increase in the number of parameters, nor sample size. Result: more complex models often will fare better on these tests.</li>
<li>For K-S and A-D tests, no adjustments are made to account for sample size. Result: large sample size increases probability of rejecting all models.</li>
<li>The <code>\(\chi ^{2}\)</code> test adjusts the degrees of freedom for increases in the number of parameters, but is easily manipulated as the choice of brackets is arbitrary.</li>
</ul>
<h2 id="information-criteria">
  Information criteria
  <a class="anchor" href="#information-criteria">#</a>
</h2>
<ul>
<li>Information criteria penalise the log likelihood with a function that depends on the number of parameters.</li>
<li>Akaike Information Criterion (AIC):
<code>$$\text{AIC}^{(i)}=-2\ell^{(i)}_\mathbf{Y}+2d^{(i)},$$</code>
where <code>\(d^{(i)}\)</code> denotes the number of estimated parameters in the density <code>\(g_i\)</code> that is considered, and where <code>\(\ell^{(i)}_\mathbf{Y}\)</code> is the maximum log likelihood that can be achieved with that density.</li>
<li>Bayesian Information Criterion (BIC)
<code>$$\text{BIC}^{(i)}=-2\ell^{(i)}_\mathbf{Y}+\log (n) d^{(i)}.$$</code>
This is <code>\(-2\text{SBC}\)</code>, where SBC is Schwarz Bayesian Criterion.</li>
</ul>
<hr>
<ul>
<li>Note that these can sometimes be presented in inverse sign. Here, because the penalty is added, it is obvious that smaller values of the IC are preferred.</li>
</ul>
<h3 id="suva-gof-stats">
  SUVA GOF stats
  <a class="anchor" href="#suva-gof-stats">#</a>
</h3>
<p>For MLE:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">gofstat</span>(<span style="color:#a6e22e">list</span>(fit.weibull.mle, fit.lnorm.mle, fit.gamma.mle),
  fitnames <span style="color:#f92672">=</span> plot.legend)
</code></pre></div><pre><code>## Goodness-of-fit statistics
##                                  Weibull  lognormal      gamma
## Kolmogorov-Smirnov statistic  0.07105097 0.04276791 0.03376236
## Cramer-von Mises statistic    1.74049707 0.26568341 0.19438834
## Anderson-Darling statistic   10.69572021 1.70209314 1.10385675
## 
## Goodness-of-fit criteria
##                                 Weibull lognormal    gamma
## Akaike's Information Criterion 4010.519  3920.717 3907.636
## Bayesian Information Criterion 4020.524  3930.722 3917.641
</code></pre>
<hr>
<p>For MME:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">gofstat</span>(<span style="color:#a6e22e">list</span>(fit.weibull.mme, fit.lnorm.mme, fit.gamma.mme),
  fitnames <span style="color:#f92672">=</span> plot.legend)
</code></pre></div><pre><code>## Goodness-of-fit statistics
##                                  Weibull lognormal     gamma
## Kolmogorov-Smirnov statistic  0.08023228 0.0374087 0.0327241
## Cramer-von Mises statistic    1.66608962 0.1869752 0.1823197
## Anderson-Darling statistic   10.53097690 1.4369047 1.0539353
## 
## Goodness-of-fit criteria
##                                 Weibull lognormal    gamma
## Akaike's Information Criterion 4044.239  3922.121 3907.677
## Bayesian Information Criterion 4054.243  3932.125 3917.681
</code></pre>
<p>Note that when fitting discrete distributions, the chi-squared statistic is computed by the <code>gofstat</code> function (see Delignette-Muller and Dutang (2015) for details).</p>
<h3 id="gof-actual-hypothesis-test-results">
  GOF Actual hypothesis test results
  <a class="anchor" href="#gof-actual-hypothesis-test-results">#</a>
</h3>
<p>R can also provide the results from the GOF hypothesis tests. For instance:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">gammagof <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">gofstat</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mle, fit.lnorm.mle), fitnames <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;gamma MLE&#34;</span>,
  <span style="color:#e6db74">&#34;lognormal MLE&#34;</span>), chisqbreaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">10</span><span style="color:#f92672">:</span><span style="color:#ae81ff">20</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>))
gammagof<span style="color:#f92672">$</span>chisqpvalue
</code></pre></div><pre><code>##     gamma MLE lognormal MLE 
##  1.374256e-03  1.690633e-05
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">gammagof<span style="color:#f92672">$</span>adtest
</code></pre></div><pre><code>##      gamma MLE  lognormal MLE 
##     &quot;rejected&quot; &quot;not computed&quot;
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">gammagof<span style="color:#f92672">$</span>kstest
</code></pre></div><pre><code>##      gamma MLE  lognormal MLE 
## &quot;not rejected&quot;     &quot;rejected&quot;
</code></pre>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">gammagof<span style="color:#f92672">$</span>chisqtable
</code></pre></div><pre><code>##        obscounts theo gamma MLE theo lognormal MLE
## &lt;= 5          36       23.96251           19.19169
## &lt;= 5.5        28       39.64865           39.53512
## &lt;= 6          60       72.77895           76.73318
## &lt;= 6.5       110      109.47716          116.38286
## &lt;= 7         130      139.03193          145.08202
## &lt;= 7.5       191      152.62949          154.45787
## &lt;= 8         134      147.62688          144.65495
## &lt;= 8.5       141      127.77796          121.96771
## &lt;= 9          91      100.25469           94.30131
## &lt;= 9.5        62       72.07629           67.84850
## &lt;= 10         51       47.91524           45.97086
## &gt; 10          65       65.82026           72.87394
</code></pre>
<h3 id="gof-graphical-comparisons">
  GOF graphical comparisons
  <a class="anchor" href="#gof-graphical-comparisons">#</a>
</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">plot.legend <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;lognormal MLE&#34;</span>, <span style="color:#e6db74">&#34;lognormal MME&#34;</span>)
fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">denscomp</span>(<span style="color:#a6e22e">list</span>(fit.lnorm.mle, fit.lnorm.mme), legendtext <span style="color:#f92672">=</span> plot.legend,
  fitlwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-GOF-graphs-lnorm-mlevsmme-dens-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">cdfcomp</span>(<span style="color:#a6e22e">list</span>(fit.lnorm.mle, fit.lnorm.mme), legendtext <span style="color:#f92672">=</span> plot.legend,
  fitlwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, datapch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-GOF-graphs-lnorm-mlevsmme-cdf-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">ppcomp</span>(<span style="color:#a6e22e">list</span>(fit.lnorm.mle, fit.lnorm.mme), legendtext <span style="color:#f92672">=</span> plot.legend,
  fitpch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-GOF-graphs-lnorm-mlevsmme-pp-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">qqcomp</span>(<span style="color:#a6e22e">list</span>(fit.lnorm.mle, fit.lnorm.mme), legendtext <span style="color:#f92672">=</span> plot.legend,
  fitpch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-GOF-graphs-lnorm-mlevsmme-qq-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">plot.legend <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;lognormal MLE&#34;</span>, <span style="color:#e6db74">&#34;lognormal MME&#34;</span>)
fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">denscomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mle, fit.gamma.mme), legendtext <span style="color:#f92672">=</span> plot.legend,
  fitlwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-GOF-graphs-gamma-mlevsmme-dens-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">cdfcomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mle, fit.gamma.mme), legendtext <span style="color:#f92672">=</span> plot.legend,
  fitlwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, datapch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-GOF-graphs-gamma-mlevsmme-cdf-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">ppcomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mle, fit.gamma.mme), legendtext <span style="color:#f92672">=</span> plot.legend,
  fitpch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-GOF-graphs-gamma-mlevsmme-pp-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fitdistrplus<span style="color:#f92672">::</span><span style="color:#a6e22e">qqcomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mle, fit.gamma.mme), legendtext <span style="color:#f92672">=</span> plot.legend,
  fitpch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/SUVA-GOF-graphs-gamma-mlevsmme-qq-1.png" width="672" /></p>
<h1 id="adv-other-advanced-topics">
  <code>\(\adv\)</code> Other advanced topics
  <a class="anchor" href="#adv-other-advanced-topics">#</a>
</h1>
<h2 id="adv-alternative-methods-for-estimation">
  <code>\(\adv\)</code> Alternative methods for estimation
  <a class="anchor" href="#adv-alternative-methods-for-estimation">#</a>
</h2>
<h3 id="adv-maximum-goodness-estimation-mge">
  <code>\(\adv\)</code> Maximum Goodness Estimation (MGE)
  <a class="anchor" href="#adv-maximum-goodness-estimation-mge">#</a>
</h3>
<ul>
<li>This is one form of “minimum distance estimation,” whereby parameters are chosen such that a distance (between empirical and theoretical) is minimised</li>
<li>Here we focus on the GOF tests <code>AD</code>, <code>CvM</code>, and <code>KS</code></li>
<li>This can be readily chosen in R using <code>fitdist</code>, with <code>method=&quot;mge&quot;</code> and where <code>gof=</code> one of <code>AD</code>, <code>CvM</code>, or <code>KS</code>.</li>
</ul>
<hr>
<p>With the SUVA data:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.gamma.mge.ad <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]), <span style="color:#e6db74">&#34;gamma&#34;</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mge&#34;</span>, gof <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AD&#34;</span>)
fit.gamma.mge.ks <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]), <span style="color:#e6db74">&#34;gamma&#34;</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mge&#34;</span>, gof <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;KS&#34;</span>)
gof.mge.legend <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;gamma MLE&#34;</span>, <span style="color:#e6db74">&#34;gamma MGE AD&#34;</span>, <span style="color:#e6db74">&#34;gamma MGE KS&#34;</span>)
<span style="color:#a6e22e">gofstat</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mle, fit.gamma.mge.ad, fit.gamma.mge.ks),
  fitnames <span style="color:#f92672">=</span> gof.mge.legend)
</code></pre></div><pre><code>## Goodness-of-fit statistics
##                               gamma MLE gamma MGE AD gamma MGE KS
## Kolmogorov-Smirnov statistic 0.03376236   0.02841676    0.0208791
## Cramer-von Mises statistic   0.19438834   0.14533386    0.1444858
## Anderson-Darling statistic   1.10385675   0.96063188    1.6991376
## 
## Goodness-of-fit criteria
##                                gamma MLE gamma MGE AD gamma MGE KS
## Akaike's Information Criterion  3907.636     3908.736     3919.475
## Bayesian Information Criterion  3917.641     3918.740     3929.480
</code></pre>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">denscomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mle, fit.gamma.mge.ad, fit.gamma.mge.ks),
  legendtext <span style="color:#f92672">=</span> gof.mge.legend, fitlwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/GOF-MGE-gamma-comp-1-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">cdfcomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mle, fit.gamma.mge.ad, fit.gamma.mge.ks),
  legendtext <span style="color:#f92672">=</span> gof.mge.legend, fitlwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, datapch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/GOF-MGE-gamma-comp-2-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">ppcomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mle, fit.gamma.mge.ad, fit.gamma.mge.ks),
  legendtext <span style="color:#f92672">=</span> gof.mge.legend, fitpch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/GOF-MGE-gamma-comp-3-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">qqcomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mle, fit.gamma.mge.ad, fit.gamma.mge.ks),
  legendtext <span style="color:#f92672">=</span> gof.mge.legend, fitpch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/GOF-MGE-gamma-comp-4-1.png" width="672" /></p>
<h3 id="adv-ad-based-parameter-estimation">
  <code>\(\adv\)</code> AD based parameter estimation
  <a class="anchor" href="#adv-ad-based-parameter-estimation">#</a>
</h3>
<ul>
<li>Recall the Anderson-Darling test statistic, which focused on the tails.</li>
<li>What if we wanted to generalise the idea of AD to left tail or right tail only, or put even more weight on either of those tails?</li>
<li>The AD test considers a weighted “sum” (integral) of the squared difference between empirical and theoretical cdf’s</li>
<li>In its original formulation, the weight is of the form
$$ w_i= \frac{1}{G(y) [1-G(y)]},$$
which goes to infinity when <code>\(y\rightarrow 0\)</code> or <code>\(y\rightarrow \infty\)</code>.</li>
<li>There are 5 alternatives in <code>fitdistrplus</code>.</li>
</ul>
<hr>
<ul>
<li><code>ADR</code>: Right-tail AD, where
<code>$$w_i = \frac{1}{1-G(y)};$$</code></li>
<li><code>ADL</code>: Left-tail AD, where
<code>$$w_i = \frac{1}{G(y)};$$</code></li>
<li><code>ADR2</code>: Right-tail AD, 2nd order, where
<code>$$w_i = \frac{1}{[1-G(y)]^2};$$</code></li>
<li><code>ADL2</code>: Left-tail AD, 2nd order, where
<code>$$w_i = \frac{1}{[G(y)]^2};$$</code></li>
<li><code>AD2</code>: AD, 2nd order. Here, <code>R</code> will minimise <code>ADR2</code> + <code>ADL2</code>.</li>
</ul>
<hr>
<p>With the SUVA data:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.gamma.mge.adr <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]), <span style="color:#e6db74">&#34;gamma&#34;</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mge&#34;</span>, gof <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ADR&#34;</span>)
fit.gamma.mge.adr2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]), <span style="color:#e6db74">&#34;gamma&#34;</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mge&#34;</span>, gof <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AD2R&#34;</span>)
gof.mge.legend2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;gamma MGE AD&#34;</span>, <span style="color:#e6db74">&#34;gamma MGE ADR&#34;</span>, <span style="color:#e6db74">&#34;gamma MGE ADR2&#34;</span>)
</code></pre></div><hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">gofstat</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mge.ad, fit.gamma.mge.adr, fit.gamma.mge.adr2),
  fitnames <span style="color:#f92672">=</span> gof.mge.legend2)
</code></pre></div><pre><code>## Goodness-of-fit statistics
##                              gamma MGE AD gamma MGE ADR
## Kolmogorov-Smirnov statistic   0.02841676     0.0309970
## Cramer-von Mises statistic     0.14533386     0.1553754
## Anderson-Darling statistic     0.96063188     0.9799768
##                              gamma MGE ADR2
## Kolmogorov-Smirnov statistic     0.03980158
## Cramer-von Mises statistic       0.24760685
## Anderson-Darling statistic       1.38154307
## 
## Goodness-of-fit criteria
##                                gamma MGE AD gamma MGE ADR
## Akaike's Information Criterion     3908.736      3908.223
## Bayesian Information Criterion     3918.740      3918.228
##                                gamma MGE ADR2
## Akaike's Information Criterion       3908.049
## Bayesian Information Criterion       3918.054
</code></pre>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">denscomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mge.ad, fit.gamma.mge.adr, fit.gamma.mge.adr2),
  legendtext <span style="color:#f92672">=</span> gof.mge.legend2, fitlwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/GOF-MGE-gamma-comp2-1-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">cdfcomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mge.ad, fit.gamma.mge.adr, fit.gamma.mge.adr2),
  legendtext <span style="color:#f92672">=</span> gof.mge.legend2, fitlwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, datapch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/GOF-MGE-gamma-comp2-2-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">ppcomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mge.ad, fit.gamma.mge.adr, fit.gamma.mge.adr2),
  legendtext <span style="color:#f92672">=</span> gof.mge.legend2, fitpch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/GOF-MGE-gamma-comp2-3-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">qqcomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mge.ad, fit.gamma.mge.adr, fit.gamma.mge.adr2),
  legendtext <span style="color:#f92672">=</span> gof.mge.legend2, fitpch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/GOF-MGE-gamma-comp2-4-1.png" width="672" /></p>
<h3 id="adv-quantile-matching">
  <code>\(\adv\)</code> Quantile matching
  <a class="anchor" href="#adv-quantile-matching">#</a>
</h3>
<ul>
<li>Quantile matching is easily implemented in R:
<ul>
<li>set <code>method=&quot;qme&quot;</code> in the call to <code>fitdist</code>;</li>
<li>and add an argument <code>probs</code> defining the probabilities for which the quantile matching is performed.</li>
</ul>
</li>
<li>The number of quantiles to match must be the same as the number of parameters to estimate.</li>
<li>The quantile matching is carried out numerically, by minimising the sum of squared differences between observed and theoretical quantiles.</li>
</ul>
<p>For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.gamma.qme <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]), <span style="color:#e6db74">&#34;gamma&#34;</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;qme&#34;</span>, probs <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.75</span>))
fit.lnorm.qme <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdist</span>(<span style="color:#a6e22e">log</span>(SUVA<span style="color:#f92672">$</span>dailyallow[SUVA<span style="color:#f92672">$</span>dailyallow <span style="color:#f92672">&gt;</span>
  <span style="color:#ae81ff">0</span>]), <span style="color:#e6db74">&#34;lnorm&#34;</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;qme&#34;</span>, probs <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.75</span>))
gof.qme.legend <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;gamma MLE&#34;</span>, <span style="color:#e6db74">&#34;gamma QME&#34;</span>, <span style="color:#e6db74">&#34;lognormal QME&#34;</span>)
</code></pre></div><hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">denscomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mle, fit.gamma.qme, fit.lnorm.qme), legendtext <span style="color:#f92672">=</span> gof.qme.legend,
  fitlwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/GOF-QME-1-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">cdfcomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mle, fit.gamma.qme, fit.lnorm.qme), legendtext <span style="color:#f92672">=</span> gof.qme.legend,
  fitlwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, datapch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/GOF-QME-2-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">ppcomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mle, fit.gamma.qme, fit.lnorm.qme), legendtext <span style="color:#f92672">=</span> gof.qme.legend,
  fitpch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/GOF-QME-3-1.png" width="672" /></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">qqcomp</span>(<span style="color:#a6e22e">list</span>(fit.gamma.mle, fit.gamma.qme, fit.lnorm.qme), legendtext <span style="color:#f92672">=</span> gof.qme.legend,
  fitpch <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p><img src="https://gim-am3.netlify.app/docs/1-claims-modelling/m3-individual-claim-size-modelling/index_files/figure-html/GOF-QME-4-1.png" width="672" /></p>
<h2 id="adv-zero-inflated-severity-model-xib">
  <code>\(\adv\)</code> Zero-inflated severity model <code>\(X=IB\)</code>
  <a class="anchor" href="#adv-zero-inflated-severity-model-xib">#</a>
</h2>
<p>In this approach <code>\(X=IB\)</code>, where</p>
<ul>
<li><code>\(I\)</code> is an indicator of claim with <code>$$\Pr\left[ I=1\right] =q\text{ and }\Pr\left[ I=0\right] =1-q$$</code></li>
<li><code>\(B\)</code> is the {claim amount given <code>\(I=1\)</code>} (given a claim occurs).</li>
</ul>
<p>This allows us to avoid a large probability mass at 0 for rare losses.</p>
<hr>
<ul>
<li>Note that this is a good approach for modifying continuous distributions, which are generally used for severity.</li>
<li>In the case of discrete distributions—usually used for frequency, modifications of the usual distributions (in the form of “zero-truncated” or “zero-modified”) are well known, and readily available in the package <code>actuar</code>. This is discussed in Module 2.</li>
<li>In practice a frequency and severity model would be chosen at the same time, and the way zero claims are dealt with should be determined in a consistent way, e.g.:
<ul>
<li>“frequency” models strictly positive claims, and “severity” is a strictly positive continuous distribution;</li>
<li>“frequency” models insurable events (which may lead to claims of 0), and “severity” includes a mass at 0 (such as in this section);</li>
<li>etc…</li>
</ul>
</li>
</ul>
<h3 id="adv-resulting-distribution">
  <code>\(\adv\)</code> Resulting distribution
  <a class="anchor" href="#adv-resulting-distribution">#</a>
</h3>
<p>As a consequence,</p>
<p><code>$$\begin{array}{rcl} \Pr\left[ X\leq x \right] &amp;=&amp;\Pr\left[ X\leq x | I=0\right]\Pr[I=0]\\&amp;&amp;+\Pr\left[ X\leq x | I=1\right]\Pr[I=1] \\ &amp;=&amp;1-q+q\Pr\left[ B\leq x \right] \end{array}$$</code>
and</p>
<p><code>$$\begin{array}{rcl} M_X(t)&amp;=&amp;E[e^{tX}|I=0]\Pr[I=0]\\ &amp;&amp;+E[e^{tX}|I=1]\Pr[I=1]\\ &amp;=&amp;1-q+q E[e^{tB}]. \end{array}$$</code></p>
<h3 id="adv-mean-and-variance">
  <code>\(\adv\)</code> Mean and Variance
  <a class="anchor" href="#adv-mean-and-variance">#</a>
</h3>
<p>The <strong>mean</strong> can be determined using
<code>$$E\left[ X\right] =E\left[ E\left[ X\left\vert I\right. \right]\right] =E\left[ X\left\vert I\right. =1\right] \Pr\left[ I=1\right]=qE\left( B\right),$$</code>
after noting that <code>\(E\left[ X\left\vert I\right. =0\right] =0\)</code>.</p>
<p>The <strong>variance</strong> can be determined using</p>
<p><code>$$\begin{array}{rcl} Var\left( X\right) &amp;=&amp;Var\left( E\left[ X\left\vert I\right.\right] \right)+E\left[ Var\left( X\left\vert I\right. \right) \right] \\ &amp;=&amp;\left[ E\left( B\right) \right] ^{2}Var\left( I\right)+qVar\left(B\right) \\ &amp;=&amp;q\left( 1-q\right) \left( E\left[ B\right] \right)^{2}+qVar\left( B\right) \end{array}$$</code></p>
<p>after noting that</p>
<p><code>$$\begin{array}{rcl} E[ X|I] &amp;=&amp;I \cdot E[ B],\text{ and that} \\ Var( X| I)&amp;=&amp;I^2 \cdot Var(B), \end{array}$$</code></p>
<p>which are both random variables (functions of <code>\(I\)</code>).</p>
<h3 id="adv-special-case-xib">
  <code>\(\adv\)</code> Special case: <code>\(X=Ib\)</code>
  <a class="anchor" href="#adv-special-case-xib">#</a>
</h3>
<ul>
<li>Fixed claim: <code>\(B=b\)</code> with probability 1.</li>
<li>The individual claim random variable becomes
<code>$$X=Ib=\left\{ \begin{array}{ll} b, &amp; \text{w.p. }q \\ 0, &amp; \text{w.p. }1-q \end{array} \right. \text{.}$$</code></li>
<li>Mean: <code>\(E\left[ X\right] =bq\)</code></li>
<li>Variance: <code>\(Var\left( X\right) =b^{2}Var\left( I\right)=b^{2}q\left( 1-q\right)\)</code></li>
</ul>
<p>This is nothing more than a scaled Bernoulli…
(and if you add them, the sum becomes a scaled Binomial)</p>
<h3 id="adv-example-bicycle-theft-get-b-out-of-x">
  <code>\(\adv\)</code> Example: Bicycle Theft (get <code>\(B\)</code> out of <code>\(X\)</code>)
  <a class="anchor" href="#adv-example-bicycle-theft-get-b-out-of-x">#</a>
</h3>
<ul>
<li>Insurance policy against bicycle theft (insured amount is 400)</li>
<li>Only half is paid if bicycle is not locked.</li>
<li>Assume: <code>\(\Pr\left[ X=400\right] =0.05\)</code> and <code>\(\Pr\left[X=200\right] =0.15\)</code>.</li>
<li>Probability of a claim: <code>\(q=\Pr\left[ I=1\right] =0.20\)</code>
[law of total probability]</li>
<li>The pmf of <code>\(B\)</code> is computed in the following way</li>
</ul>
<p><code>$$\begin{array}{rcl} \Pr\left[ B=400 \right] &amp;=&amp;\Pr[ X=400 | I=1] = \frac{\Pr[X=400 \ \cap\ I=1]}{\Pr[I=1]}\\ &amp;=&amp;\frac{0.05}{0.20} = 0.25 \end{array}$$</code></p>
<h3 id="adv-example">
  <code>\(\adv\)</code> Example
  <a class="anchor" href="#adv-example">#</a>
</h3>
<p>In an insurance portfolio, there are 15 insured:</p>
<ul>
<li>ten of the insured persons have 0.1 probability of making a claim, and</li>
<li>the other 5 have a 0.2 probability of making a claim.</li>
</ul>
<p>All claims are independent and follow an exponential distribution with mean <code>\(1/\lambda\)</code>. What is the mgf of the aggregate claims distribution?</p>
<hr>
<p>Let <code>\(X_i\)</code> be the total amount of claims incurred from the <code>\(i\)</code>th person, and <code>\(B_i\)</code> denote the amount of claim, if there is one. Then <code>\(X_i=I_iB_i\)</code>.</p>
<p>If <code>\(q_i=\Pr(I_i=1)\)</code> then <code>\(q_1=\cdots=q_{10}=0.1\)</code> and <code>\(q_{11}=\cdots=q_{15}=0.2.\)</code></p>
<p>The mgf of <code>\(X_i\)</code>:</p>
<p><code>$$\begin{array}{rcl} M_{X_i}(t)&amp;=&amp;E[e^{tX_i}|I_i=0]\Pr(I_i=0)+E[e^{tX_i}|I_i=1]\Pr(I_i=1) \\ &amp;=&amp;1-q_i+E[e^{tB_i}]q_i=1-q_i+\frac{\lambda}{\lambda-t}q_i \end{array}$$</code></p>
<p>Since the aggregate claims are <code>\(S=X_1+\cdots+X_{15}\)</code> the mgf of <code>\(S\)</code> is</p>
<p><code>$$\begin{array}{rcl} M_{S}(t)&amp;=&amp;\prod_{i=1}^{15}E[e^{tX_i}] \\ &amp;=&amp;\left(1-0.1+0.1\frac{\lambda}{\lambda-t}\right)^{10}\left(1-0.2+0.2\frac{\lambda}{\lambda-t}\right)^{5} \end{array}$$</code></p>
<h1 id="calculating-within-layers-for-claim-sizes-mw-34">
  Calculating within layers for claim sizes (MW 3.4)
  <a class="anchor" href="#calculating-within-layers-for-claim-sizes-mw-34">#</a>
</h1>
<h2 id="usual-policy-transformations">
  Usual policy transformations
  <a class="anchor" href="#usual-policy-transformations">#</a>
</h2>
<h3 id="deductible-and-policy-limit">
  Deductible and Policy Limit
  <a class="anchor" href="#deductible-and-policy-limit">#</a>
</h3>
<p>One way to control the cost (and variability) of individual claim losses is to introduce deductibles and policy limits.</p>
<ul>
<li><strong>Deductible</strong> <code>\(d\)</code>: the insurer starts paying claim amounts above the deductible <code>\(d\)</code></li>
<li><strong>Limit</strong> <code>\(M\)</code>: the insurer pays up to the limit <code>\(M\)</code>.</li>
</ul>
<p>If we denote the damage random variable by <code>\(D\)</code>, then if a claim occurs the insurer is liable for</p>
<p><code>$$\begin{array} X=\min \left[ \max \left( D-d,0\right) ,M\right] \text{.} \end{array}$$</code></p>
<h2 id="reinsurance">
  Reinsurance
  <a class="anchor" href="#reinsurance">#</a>
</h2>
<p>Reinsurance is a <strong>risk transfer</strong> from an insurer (the direct writer) to a reinsurer:</p>
<ul>
<li>in other words, some of the (random) risk faced by the insurer is “transfered” to the reinsurer (that means the reinsurer will cover that risk), in exchange of a (deterministic) premium (which will obviously generally be higher than the expected value of the risk that was transferred)</li>
<li>the risk that the insurer keeps is called the retention</li>
</ul>
<hr>
<p>There are different types of reinsurance:</p>
<ul>
<li>proportional
<ul>
<li>quota share: the proportion is the same for all risks</li>
<li>surplus: the proportion can vary from risk to risk</li>
</ul>
</li>
<li>nonproportional
<ul>
<li>(individual) excess of loss: on each individual loss <code>\((X_i)\)</code></li>
<li>stop loss: on the aggregate loss <code>\((S)\)</code></li>
</ul>
</li>
<li>cheap (reinsurance premium is the expected value), or
non cheap (reinsurance premium is loaded)</li>
<li>Alternative Risk Transfers (“ART”), where usually the idea is to transfer the risk to different / deeper pockets. For instance, for transfers to the financial markets:
<ul>
<li>Catastrophe bonds (“CAT bonds”)</li>
<li>Longevity bonds</li>
<li>Pandemic bonds</li>
</ul>
</li>
</ul>
<h2 id="proportional-reinsurance">
  Proportional reinsurance
  <a class="anchor" href="#proportional-reinsurance">#</a>
</h2>
<p>The <strong>retained proportion</strong> <code>\(\alpha\)</code> defines who pays what:</p>
<ul>
<li>the insurer pays <code>\(Y=\alpha X\)</code></li>
<li>the reinsurer pays <code>\(Z=(1-\alpha) X\)</code></li>
</ul>
<p>This is nothing else but a change of scale and we have
<code>$$\mu_Y=\alpha \mu_X,\;\;\;\sigma^2_Y=\alpha^2\sigma^2_X,\;\;\;\gamma_Y=\gamma_X.$$</code>
In some cases it suffices to adapt the scale parameter. Example:</p>
<ul>
<li>If <code>\(X\)</code> is exponential with parameter <code>\(\beta\)</code>
<code>$$\Pr[Y\le y]=\Pr[\alpha X \le y]=\Pr[X \le y/\alpha] = 1-e^{-\beta y / \alpha}$$</code>
and thus <code>\(Y\)</code> is exponential with parameter <code>\(\beta/\alpha\)</code>.</li>
</ul>
<h2 id="nonproportional-reinsurance">
  Nonproportional reinsurance
  <a class="anchor" href="#nonproportional-reinsurance">#</a>
</h2>
<p>Basic arrangements:</p>
<ul>
<li>the reinsurer pays the excess over a <strong>retention (excess point)</strong> <code>\(d\)</code>
<ul>
<li>the insurer pays <code>\(Y=\min(X,d)\)</code></li>
<li>the reinsurer pays <code>\(Z=(X-d)_+\)</code>
<ul>
<li><code>\(E[(X-d)_+]\)</code> is called <strong>stop-loss premium</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>the reinsurer limits his payments to an amount <code>\(M\)</code>. In that case
<ul>
<li>the insurer pays <code>\(Y=\min(X,d)+(X-M-d)_+\)</code></li>
<li>the reinsurer pays <code>\(Z=\min\left\{(X-d)_+,M\right\}\)</code></li>
</ul>
</li>
</ul>
<h3 id="example">
  Example
  <a class="anchor" href="#example">#</a>
</h3>
<p>Consider a life insurance company with <code>\(16,\!000\)</code> 1-year term life insurance policies. The associated insured amounts are:</p>
<table>
<thead>
<tr>
<th><em>Benefit (10000’s)</em></th>
<th><em># policies}</em></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>8000</td>
</tr>
<tr>
<td>2</td>
<td>3500</td>
</tr>
<tr>
<td>3</td>
<td>2500</td>
</tr>
<tr>
<td>5</td>
<td>1500</td>
</tr>
<tr>
<td>1</td>
<td>&amp;500</td>
</tr>
</tbody>
</table>
<p>The probability of death <code>\((q)\)</code> for each of the <code>\(16,\!000\)</code> lives is 0.02. This company has an EoL reinsurance contract with retention limit <code>\(30,\!000\)</code> at a cost of 0.025 per dollar of coverage.</p>
<p>What is the approximate probability (using CLT) that the total cost will exceed <code>\(8,\!250,\!000\)</code>?</p>
<hr>
<p>The portfolio of retained business is given by</p>
<table>
<thead>
<tr>
<th><code>\(k\)</code></th>
<th><em>retained benefit <code>\(b_k\)</code> (10000’s)</em></th>
<th><em># policies <code>\(n_k\)</code></em></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>8000</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>3500</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>4500</td>
</tr>
</tbody>
</table>
<p>Now</p>
<p><code>$$\begin{array}{rcl} E[S]&amp;=&amp;\sum_{k=1}^3 n_k E[X_k]=\sum_{k=1}^3 n_k b_kq_k \\ &amp;=&amp; 8000\cdot1\cdot 0.02+3500\cdot2\cdot 0.02+4500\cdot3\cdot 0.02 \\ &amp;=&amp;570,\quad\text{ and} \\ Var[S]&amp;=&amp;\sum_{k=1}^3 n_k Var[X_k]=\sum_{k=1}^3 n_k b_k^2q_k(1-q_k) \\ &amp;=&amp; 8000\cdot1^2\cdot 0.02\cdot 0.98+3500\cdot2^2\cdot 0.02\cdot 0.98 \\ &amp;&amp;+4500\cdot3^2\cdot 0.02\cdot 0.98\\&amp;=&amp;1225 \end{array}$$</code></p>
<hr>
<p>The reinsurance cost is
<code>$$[(5-3)\cdot 1500+(10-3)\cdot 500] \cdot 0.025=162.5.$$</code></p>
<p>Thus, the desired probability becomes</p>
<p><code>$$\begin{array}{rcl} \Pr[S+162.5&gt;825]&amp;=&amp;\Pr\left[\frac{S-E[S]}{\sqrt{Var(S)}}&gt;\frac{662.5-E[S]}{\sqrt{Var(S)}}\right] \\ &amp;\approx&amp; \Pr\left[Z&gt;\frac{662.5-570}{\sqrt{1225}}\right] \\ &amp;=&amp;\Pr[Z&gt;2.643]=0.0041. \end{array}$$</code></p>
<hr>
<p>Discussion:</p>
<ul>
<li>Without reinsurance, exp/var is 700/2587.20 so the associated probability of shortfall is <code>\(\approx \Pr[Z&gt;2.458]\)</code>, which is higher even though it is not cheap reinsurance.</li>
<li>However, there is lower expected gain:
<ul>
<li>With reinsurance the expected gain is <code>$$P-570-162.5=P-732.5$$</code></li>
<li>Without reinsurance it is
<code>$$P-700,$$</code> which is higher.</li>
</ul>
</li>
</ul>
<h3 id="adv-the-actuar-coverage-function">
  <code>\(\adv\)</code> The <code>actuar</code> <code>coverage</code> function
  <a class="anchor" href="#adv-the-actuar-coverage-function">#</a>
</h3>
<ul>
<li>The package <code>actuar</code> allows for direct specification of the pdf of a modified random variable after possible left-trunction and right-censoring.</li>
<li>Given the pdf or cdf of the original loss <code>\(D\)</code>, <code>coverage</code> returns a function object to compute the pdf or cdf of the modified random variable after one or several of the following modifications:
<ul>
<li>ordinary deductible <code>\(d\)</code>;</li>
<li>franchise deductible <code>\(d\)</code>;</li>
<li>limit <code>\(u\)</code>;</li>
<li>coinsurance <code>\(\alpha\)</code>;</li>
<li>inflation <code>\(r\)</code>.</li>
</ul>
</li>
<li>The 
  <a href="https://cra%7Dn.r-project.org/web/packages/actuar/vignettes/modeling.pdf">vignette on loss modeling features</a> of <code>actuar</code> provides precise definitions, and 
  <a href="https://cran.r-project.org/web/packages/actuar/vignettes/coverage.pdf">this document summarises all the formulas</a>.</li>
</ul>
<hr>
<p>Assume that insurance payments are
<code>$$X = \left\{ \begin{array}{cc} D-d, &amp; d\le D\le u \\ u-d, &amp; D\ge u \end{array}\right.$$</code>
with mixed distribution
<code>$$f_X(y) = \left\{ \begin{array}{cc} 0, &amp; x=0 \\ \frac{f_D(y+d)}{1-F_D(d)}, &amp; 0&lt; x &lt; u-d \\ \frac{1-F_D(u)}{1-F_D(d)}, &amp;  x=u-d \\ 0 &amp; x&gt;u-d \end{array}\right.$$</code>
as seen before. Note however that the <code>\(u\)</code> is expressed on the raw variable <code>\(D\)</code>, not the payment, so that the maximum payment is <code>\(u-d\)</code>.</p>
<hr>
<p>If <code>\(D\)</code> is gamma, <code>\(d=2\)</code>, and <code>\(u=20\)</code>, one can get <code>\(f_X(x)\)</code> in R as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">f <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">coverage</span>(pdf <span style="color:#f92672">=</span> dgamma, cdf <span style="color:#f92672">=</span> pgamma, deductible <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><p>The function can be then used to fit distributions to data.</p>
<p>As an example we will use the previously generated data <code>xcens</code>. Note it needs to be shifted by <code>\(d\)</code> down, because what we have is the left-truncated and right-censored <code>\(D\)</code>, not the insurance payments as per the formulation above.</p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fit.gamma.xcens2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fitdistr</span>(xcens<span style="color:#f92672">$</span>left <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>, f, start <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(shape <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(xcens<span style="color:#f92672">$</span>left)^2<span style="color:#f92672">/</span><span style="color:#a6e22e">var</span>(xcens<span style="color:#f92672">$</span>left),
  rate <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(xcens<span style="color:#f92672">$</span>left)<span style="color:#f92672">/</span><span style="color:#a6e22e">var</span>(xcens<span style="color:#f92672">$</span>left)))
fit.gamma.xcens2
<span style="color:#75715e">##      shape         rate   </span>
<span style="color:#75715e">##   2.03990496   0.20142871 </span>
<span style="color:#75715e">##  (0.10516140) (0.01009694)</span>
fit.tgamma.xcens  <span style="color:#75715e"># our previous fit with fitdist</span>
<span style="color:#75715e">## Fitting of the distribution &#39; tgamma &#39; on censored data by maximum likelihood </span>
<span style="color:#75715e">## Parameters:</span>
<span style="color:#75715e">##        estimate</span>
<span style="color:#75715e">## shape 2.0296237</span>
<span style="color:#75715e">## rate  0.2006534</span>
<span style="color:#75715e">## Fixed parameters:</span>
<span style="color:#75715e">##        value</span>
<span style="color:#75715e">## low 2.013575</span>
<span style="color:#a6e22e">c</span>(fit.gamma.xcens2<span style="color:#f92672">$</span>loglik, fit.tgamma.xcens<span style="color:#f92672">$</span>loglik)
<span style="color:#75715e">## [1] -5341.551 -5340.151</span>
</code></pre></div><p>Note that this is using <code>MASS::fitdistr</code> rather than the (arguably more flexible and possibly advanced) <code>fitdistrplus::fitdist</code>. This approach works as well, but does not seem as precise in this particular instance.</p>
<h3 id="a-useful-identity">
  A useful identity
  <a class="anchor" href="#a-useful-identity">#</a>
</h3>
<p>Note that
<code>$$\min(X,c)=X-(X-c)_+$$</code>
and thus
<code>$$E[\min(X,c)]=E[X]-E[(X-c)_+].$$</code>
The amount <code>\(E[(X-c)_+]=\Pr[X&gt;c]e(c)\)</code></p>
<ul>
<li>is commonly called “stop loss premium” with retention <code>\(c\)</code>.</li>
<li>is identical to the expected payoff of a call with strike price <code>\(c\)</code>, and thus results from financial mathematics can sometimes be directly used (and vice versa).</li>
</ul>
<h2 id="stop-loss-premiums">
  Stop loss premiums
  <a class="anchor" href="#stop-loss-premiums">#</a>
</h2>
<p>Let
<code>$$E[(X-d)_+]=P_d.$$</code>
Then we have (for positive rv’s)
<code>$$P_d=\left\{ \begin{array}{ll}\int_d^\infty \left[1-F_X(x)\right] dx &amp; \text{if }X\text{ is continuous} \\ \sum_d^\infty \left[1-F_X(x)\right]   &amp; \text{if }X\text{ is discrete} \end{array}\right.$$</code></p>
<h3 id="example-1">
  Example
  <a class="anchor" href="#example-1">#</a>
</h3>
<p>Calculate <code>\(P_d\)</code> if <code>\(X\)</code> is Exponential with mean <code>\(1/\beta\)</code>.</p>
<h3 id="adv-recursive-formulas-in-the-discrete-case">
  <code>\(\adv\)</code> Recursive formulas in the discrete case
  <a class="anchor" href="#adv-recursive-formulas-in-the-discrete-case">#</a>
</h3>
<p>First moment:</p>
<ul>
<li>if <code>\(d\)</code> is an integer <code>$$P_{d+1}=P_d-[1-F_X(d)]\text{ with }P_0=E[X]$$</code></li>
<li>if <code>\(d\)</code> is not an integer <code>$$P_d=P_{\lfloor d \rfloor}-(d-\lfloor d \rfloor)[1-F_X(\lfloor d \rfloor)].$$</code>
Second moment <code>\(P^2_d=E[(X-d)_+^2]\)</code>:
<code>$$P_{d+1}^2=P_{d}^2-2P_{d}+[1-F_X(d)]\text{ with }P_0^2=E[X^2].$$</code></li>
</ul>
<!-- Note also -->
<!-- `$$F_X(x)=1+\frac{d}{dx}P_x\text{ and }f_X(x)=\frac{d^2}{dx^2}P_x.$$` -->
<p>Note that <code>\(\lfloor x \rfloor\)</code> is the integer part of <code>\(x\)</code> (e.g. <code>\(\lfloor 2.5 \rfloor=2\)</code>).</p>
<h3 id="adv-numerical-example">
  <code>\(\adv\)</code> Numerical example
  <a class="anchor" href="#adv-numerical-example">#</a>
</h3>
<p>For the distribution <code>\(F_{1+2+3}\)</code> derived in Module 2 we have <code>\(E[S]=4=128/32\)</code> and <code>\(E[S^2]=19.5=624/32\)</code> and thus</p>
<table>
<thead>
<tr>
<th><code>\(d\)</code></th>
<th><code>\(f_{1+2+3}(d)\)</code></th>
<th><code>\(F_{1+2+3}(d)\)</code></th>
<th><code>\(P_d\)</code></th>
<th><code>\(P_d^2\)</code></th>
<th><code>\(Var((X-d)_+)\)</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\(0\)</code></td>
<td><code>\(1/32\)</code></td>
<td><code>\(1/32\)</code></td>
<td>128/32</td>
<td>624/32</td>
<td>3.500</td>
</tr>
<tr>
<td><code>\(1\)</code></td>
<td><code>\(2/32\)</code></td>
<td><code>\(3/32\)</code></td>
<td>97/32</td>
<td>399/32</td>
<td>3.280</td>
</tr>
<tr>
<td><code>\(2\)</code></td>
<td><code>\(4/32\)</code></td>
<td><code>\(7/32\)</code></td>
<td>68/32</td>
<td>234/32</td>
<td>2.797</td>
</tr>
<tr>
<td><code>\(3\)</code></td>
<td><code>\(6/32\)</code></td>
<td><code>\(13/32\)</code></td>
<td>43/32</td>
<td>123/32</td>
<td>2.038</td>
</tr>
<tr>
<td><code>\(4\)</code></td>
<td><code>\(6/32\)</code></td>
<td><code>\(19/32\)</code></td>
<td>24/32</td>
<td>56/32</td>
<td>1.188</td>
</tr>
<tr>
<td><code>\(5\)</code></td>
<td><code>\(6/32\)</code></td>
<td><code>\(25/32\)</code></td>
<td>11/32</td>
<td>21/32</td>
<td>0.538</td>
</tr>
<tr>
<td><code>\(6\)</code></td>
<td><code>\(4/32\)</code></td>
<td><code>\(29/32\)</code></td>
<td>4/32</td>
<td>6/32</td>
<td>0.172</td>
</tr>
<tr>
<td><code>\(7\)</code></td>
<td><code>\(2/32\)</code></td>
<td><code>\(31/32\)</code></td>
<td>1/32</td>
<td>1/32</td>
<td>0.030</td>
</tr>
<tr>
<td><code>\(8\)</code></td>
<td><code>\(1/32\)</code></td>
<td><code>\(32/32\)</code></td>
<td>0</td>
<td>0</td>
<td>0.000</td>
</tr>
</tbody>
</table>
<p><code>$$P_{2.6}=P_2-0.6\cdot(1-F_{1+2+3}(2))=53/32.$$</code></p>
<h2 id="leverage-effect-of-claims-inflation">
  Leverage effect of claims inflation
  <a class="anchor" href="#leverage-effect-of-claims-inflation">#</a>
</h2>
<p>Choose a fixed deductible <code>\(d &gt;0\)</code> and assume that the claim at time 0 is given by <code>\(Y_0\)</code>. Assume that there is a deterministic inflation index <code>\(i &gt; 0\)</code> such that the claim at time 1 can be represented by <code>\(Y_1 =(1+i)Y_0\)</code>.We have
<code>$$E[(Y_1-d)_+] \ge (1+i)E[(Y_0-d)_+].$$</code>
When tax brackets are not adapted, this leads to the so-called “bracket creep”…</p>
<h1 id="references">
  References
  <a class="anchor" href="#references">#</a>
</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-AvCaWo11" class="csl-entry">
<p>Avanzi, Benjamin, Luke C. Cassar, and Bernard Wong. 2011. “Modelling Dependence in Insurance Claims Processes with Lévy Copulas.” <em>ASTIN Bulletin</em> 41 (2): 575–609.</p>
</div>
<div id="ref-Blo59" class="csl-entry">
<p>Blom, Gunnar. 1959. <em>Statistical Estimates and Transformed Beta Variables</em>. John Wiley &amp; Sons.</p>
</div>
<div id="ref-DMDu15" class="csl-entry">
<p>Delignette-Muller, Marie Laure, and Christophe Dutang. 2015. “Fitdistrplus: An r Package for Fitting Distributions.” <em>Journal of Statistical Software</em> 64 (4).</p>
</div>
<div id="ref-fitdistrplusFAQ21" class="csl-entry">
<p>———. n.d. “Package ‘Fitdistrplus‘: Frequently Asked Questions.”</p>
</div>
<div id="ref-JoKrLe19" class="csl-entry">
<p>Jordan, Alexander, Fabian Krüger, and Sebastian Lerch. 2019. “Evaluating Probabilistic Forecasts with ‘scoringRules‘.” <em>Journal of Statistical Software</em> 90 (12).</p>
</div>
<div id="ref-Wut20" class="csl-entry">
<p>Wuthrich, Mario V. 2020. “Non-Life Insurance: Mathematics &amp; Statistics.” Lecture notes. RiskLab, ETH Zurich; Swiss Finance Institute.</p>
</div>
</div>
</article>
 
      <script src="//yihui.org/js/math-code.js"></script>
<script async
src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">



  <div><a class="flex align-center" href="https://github.com/UniMelb-Actuarial/commit/7283c0a4c689e24cb7f5b7540d56f29280f8b175" title='Last modified by Benjamin Avanzi | 22 February 2022' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>22 February 2022</span>
    </a>
  </div>



</div>



  <script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>


 
        <script src="//yihui.org/js/math-code.js"></script>
<script async
src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a>
      <ul>
        <li><a href="#steps-in-fitting-loss-models-to-data">Steps in fitting loss models to data</a></li>
        <li><a href="#insurance-data">Insurance data</a>
          <ul>
            <li><a href="#complete-vs-incomplete-data">Complete vs incomplete data</a></li>
            <li><a href="#left-truncation-and-right-censoring">Left-truncation and right-censoring</a></li>
            <li><a href="#zero-claims">Zero claims</a></li>
            <li><a href="#heavy-tailed-risks">Heavy tailed risks</a></li>
          </ul>
        </li>
        <li><a href="#data-set-used-for-illustrations">Data set used for illustrations</a></li>
      </ul>
    </li>
    <li><a href="#data-analysis-and-descriptive-statistics-mw-31">Data analysis and descriptive statistics (MW 3.1)</a>
      <ul>
        <li><a href="#raw-data">Raw data</a>
          <ul>
            <li><a href="#visualise-the-suva-raw-data">Visualise the SUVA raw data</a></li>
            <li><a href="#log-of-raw-suva-data">log of raw SUVA data</a></li>
          </ul>
        </li>
        <li><a href="#moments">Moments</a>
          <ul>
            <li><a href="#suva-moments">SUVA moments</a></li>
            <li><a href="#suva-medical-costs-skewness-and-kurtosis">SUVA Medical Costs skewness and kurtosis</a></li>
            <li><a href="#suva-daily-allowance-skewness-and-kurtosis">SUVA Daily Allowance skewness and kurtosis</a></li>
            <li><a href="#loss-index-function">Loss index function</a></li>
            <li><a href="#mean-excess-function">Mean excess function</a></li>
          </ul>
        </li>
        <li><a href="#quantiles">Quantiles</a></li>
        <li><a href="#boxplots">Boxplots</a></li>
        <li><a href="#log-log-plots">Log-log plots</a>
          <ul>
            <li><a href="#suva-log-log-plots">SUVA log-log plots</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#selected-parametric-claims-size-distributions-mw-32">Selected parametric claims size distributions (MW 3.2)</a>
      <ul>
        <li><a href="#parametric-models-for-severity-y">Parametric models for severity <code>\(Y\)</code></a>
          <ul>
            <li><a href="#gamma">Gamma</a></li>
            <li><a href="#inverse-gaussian">Inverse Gaussian</a></li>
            <li><a href="#weibull">Weibull</a></li>
            <li><a href="#lognormal">Lognormal</a></li>
            <li><a href="#log-gamma">Log-gamma</a></li>
            <li><a href="#pareto-distribution">Pareto Distribution</a></li>
          </ul>
        </li>
        <li><a href="#extreme-value-theory">Extreme Value Theory</a></li>
      </ul>
    </li>
    <li><a href="#fitting-of-distributions-mw32">Fitting of distributions (MW3.2)</a>
      <ul>
        <li><a href="#introduction-1">Introduction</a>
          <ul>
            <li><a href="#r-and-technical-notes">R and technical notes</a></li>
          </ul>
        </li>
        <li><a href="#moment-matching-estimation-mme">Moment matching estimation (MME)</a>
          <ul>
            <li><a href="#mme-for-suva">MME for SUVA</a></li>
          </ul>
        </li>
        <li><a href="#maximum-likelihood-estimation-mle">Maximum likelihood estimation (MLE)</a>
          <ul>
            <li><a href="#mle-for-suva">MLE for SUVA</a></li>
          </ul>
        </li>
        <li><a href="#parameter-uncertainty">Parameter uncertainty</a>
          <ul>
            <li><a href="#hessian-matrix">Hessian matrix</a></li>
            <li><a href="#the-wald-approximation">The Wald approximation</a></li>
            <li><a href="#standard-errors-for-suva-data">Standard errors for SUVA data</a></li>
          </ul>
        </li>
        <li><a href="#adv-bootstrap"><code>\(\adv\)</code> Bootstrap</a>
          <ul>
            <li><a href="#adv-suva-contours-and-bootstrap-results"><code>\(\adv\)</code> SUVA contours and bootstrap results</a></li>
            <li><a href="#adv-confidence-intervals-on-other-quantities"><code>\(\adv\)</code> Confidence intervals on other quantities</a></li>
          </ul>
        </li>
        <li><a href="#dealing-with-left-truncation-and-right-censoring">Dealing with left-truncation and right-censoring</a>
          <ul>
            <li><a href="#coding-of-censored-data-in-r">Coding of censored data in R</a></li>
            <li><a href="#fitting-censored-data">Fitting censored data</a></li>
            <li><a href="#left-truncation-and-r">Left-truncation and R</a></li>
            <li><a href="#fitting-a-single-level-of-left-trancated-and-right-censored-data">Fitting a single level of left-trancated and right-censored data</a></li>
            <li><a href="#fitting-multiple-levels-of-left-trancated-and-right-censored-data">Fitting multiple levels of left-trancated and right-censored data</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#model-selection-mw-33">Model selection (MW 3.3)</a>
      <ul>
        <li><a href="#graphical-approaches">Graphical approaches</a>
          <ul>
            <li><a href="#p-p-plot">P-P plot</a></li>
            <li><a href="#q-q-plot">Q-Q plot</a></li>
            <li><a href="#suva-gof-graphs">SUVA GOF graphs</a></li>
          </ul>
        </li>
        <li><a href="#hypothesis-tests">Hypothesis tests</a>
          <ul>
            <li><a href="#kolmogorov-smirnoff-test">Kolmogorov-Smirnoff test</a></li>
            <li><a href="#anderson-darling-test">Anderson-Darling test</a></li>
            <li><a href="#chi-2-goodness-of-fit-test"><code>\(\chi ^{2}\)</code> goodness-of-fit test</a></li>
            <li><a href="#how-these-tests-are-used">How these tests are used</a></li>
            <li><a href="#comparison">Comparison</a></li>
          </ul>
        </li>
        <li><a href="#information-criteria">Information criteria</a>
          <ul>
            <li><a href="#suva-gof-stats">SUVA GOF stats</a></li>
            <li><a href="#gof-actual-hypothesis-test-results">GOF Actual hypothesis test results</a></li>
            <li><a href="#gof-graphical-comparisons">GOF graphical comparisons</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#adv-other-advanced-topics"><code>\(\adv\)</code> Other advanced topics</a>
      <ul>
        <li><a href="#adv-alternative-methods-for-estimation"><code>\(\adv\)</code> Alternative methods for estimation</a>
          <ul>
            <li><a href="#adv-maximum-goodness-estimation-mge"><code>\(\adv\)</code> Maximum Goodness Estimation (MGE)</a></li>
            <li><a href="#adv-ad-based-parameter-estimation"><code>\(\adv\)</code> AD based parameter estimation</a></li>
            <li><a href="#adv-quantile-matching"><code>\(\adv\)</code> Quantile matching</a></li>
          </ul>
        </li>
        <li><a href="#adv-zero-inflated-severity-model-xib"><code>\(\adv\)</code> Zero-inflated severity model <code>\(X=IB\)</code></a>
          <ul>
            <li><a href="#adv-resulting-distribution"><code>\(\adv\)</code> Resulting distribution</a></li>
            <li><a href="#adv-mean-and-variance"><code>\(\adv\)</code> Mean and Variance</a></li>
            <li><a href="#adv-special-case-xib"><code>\(\adv\)</code> Special case: <code>\(X=Ib\)</code></a></li>
            <li><a href="#adv-example-bicycle-theft-get-b-out-of-x"><code>\(\adv\)</code> Example: Bicycle Theft (get <code>\(B\)</code> out of <code>\(X\)</code>)</a></li>
            <li><a href="#adv-example"><code>\(\adv\)</code> Example</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#calculating-within-layers-for-claim-sizes-mw-34">Calculating within layers for claim sizes (MW 3.4)</a>
      <ul>
        <li><a href="#usual-policy-transformations">Usual policy transformations</a>
          <ul>
            <li><a href="#deductible-and-policy-limit">Deductible and Policy Limit</a></li>
          </ul>
        </li>
        <li><a href="#reinsurance">Reinsurance</a></li>
        <li><a href="#proportional-reinsurance">Proportional reinsurance</a></li>
        <li><a href="#nonproportional-reinsurance">Nonproportional reinsurance</a>
          <ul>
            <li><a href="#example">Example</a></li>
            <li><a href="#adv-the-actuar-coverage-function"><code>\(\adv\)</code> The <code>actuar</code> <code>coverage</code> function</a></li>
            <li><a href="#a-useful-identity">A useful identity</a></li>
          </ul>
        </li>
        <li><a href="#stop-loss-premiums">Stop loss premiums</a>
          <ul>
            <li><a href="#example-1">Example</a></li>
            <li><a href="#adv-recursive-formulas-in-the-discrete-case"><code>\(\adv\)</code> Recursive formulas in the discrete case</a></li>
            <li><a href="#adv-numerical-example"><code>\(\adv\)</code> Numerical example</a></li>
          </ul>
        </li>
        <li><a href="#leverage-effect-of-claims-inflation">Leverage effect of claims inflation</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
<script src="//yihui.org/js/math-code.js"></script>
<script async
src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>

 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












